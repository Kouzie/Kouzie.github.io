---
title:  "쓸만한 도구모음!"

read_time: false
share: false
author_profile: false
toc: true
toc_sticky: true
# classes: wide

categories:
  - tools
---

## 개요

기존에 익숙하지 않은 툴의 사용법을 정리하는 페이지

## emmet

html 자동완성 툴  

`>` 는 자식 레벨로 생성   
`+` 는 형제 레벨로 생성  
`^` 는 부모 레벨로 생성 (위로 올라감)  
`()` 는 그룹화 연산  

`div>(header>ul>li*3>a)+footer` 이런식으로 `^`를 쓰지 않아도 같은 레벨로 지정 가능.  
`div>header>ul>li*3>a^^^footer` 이거랑 같은 연산.   

```html
<div>
  <header>
    <ul>
      <li><a href=""></a></li>
      <li><a href=""></a></li>
      <li><a href=""></a></li>
    </ul>
  </header>
  <footer></footer>
</div>
```


`[]` 속성 지정 가능  
`div[id=box class=test]`  

```html
<div id="box" class="test"></div>
```

`{}` 는 태그 안에 고정값 지정, `$`와 같이쓰면 번호매기기 가능  
`ul>li*5>{item$}`  

```html
<ul>
  <li>item1</li>
  <li>item2</li>
  <li>item3</li>
  <li>item4</li>
  <li>item5</li>
</ul>
```

`$` 를 여러개 쓰면 자리수도 맞출 수 있다.  
`ul>li.item$$$*5`  

```html
<ul>
  <li class="item001"></li>
  <li class="item002"></li>
  <li class="item003"></li>
  <li class="item004"></li>
  <li class="item005"></li>
</ul>
```


`@-`를 붙이면 역순으로 가능  
`ul>li.item$@-*5`  

```html
<ul>
    <li class="item5"></li>
    <li class="item4"></li>
    <li class="item3"></li>
    <li class="item2"></li>
    <li class="item1"></li>
</ul>
```

`@n`(n이 숫자) 는 `n`부터 시작하게 할 수 있음.  
`ul>li.item$@3*5`  

```html
<ul>
    <li class="item3"></li>
    <li class="item4"></li>
    <li class="item5"></li>
    <li class="item6"></li>
    <li class="item7"></li>
</ul>
```

`lorem` 사전에서 랜덤하게 문자를 뽑아 출력, 뒤에 쓴 숫자만큼 단어가 붙음  

`div`는 워낙 자주 사용해서  
`#`은 id, `.`은 class명으로 바로 `div`생성 가능  
`#demo.team.manager.teacher`  

```html
<div id="demo" class="team manager teacher"></div>
```

응용버전  
`table>(tr*1>td*2)+tr>td[colspan=3]`  

```html
<table>
  <tr>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td colspan="3"></td>
  </tr>
</table>
```

기타 유용 명령어  
`ul+` `select+` `table+` (tr td도 하나씩 자동 생성)

자식을 가지는 태그는 +를 붙이면 자식도 하나씩 생김(테스트 할때 좋을듯)



## ssh client

### ssh public key 등록

덮어쓰기  

```sh
ssh-keygen
scp -P 22 ~/.ssh/id_rsa.pub username@192.168.55.1:~/.ssh/authorized_keys
```

추가하기  

```sh
ssh-copy-id -i ~/.ssh/id_rsa.pub username@192.168.55.1
```

### scp

```sh
## Remote -> Local
scp -rp username@192.168.0.2:~/my_dir Downloads/my_dir

## Local -> Remote
scp -rp Downloads/my_dir username@192.168.0.2:~/my_dir
```

-r: 재귀적으로 모든 폴더들을 복사
-p: 파일의 수정 시간과 권한을 유지

## jq

```sh
brew install jq
```

`json` 데이터를 쉽게 조작할 수 있는 CLI 유틸리티

```sh
kubectl get nodes -o json 
{
    "items": [
        {
            "status": {
                "addresses": [{
                        "address": "192.168.65.3",
                        "type": "InternalIP"
                    },
                    {
                        "address": "docker-desktop",
                        "type": "Hostname"
                    }
                ]
            }
        }
    ]
}
```

위 명령어 수행시 아래와 같은 json 데이터가 출력될 경우  

파이프라인을 묶어 아래처럼 검색식으로 사용 가능하다.  

```sh
kubectl get nodes -o json | jq -r '.items[].status.addresses[] | select(.type=="InternalIP") | .address'
192.168.65.3
```

JSON 안 `items` 배열 안의 `status` 객체의 `addresses` 배열 중 `type` 이 `InternalIP` 객체 중 `address` 객체를 출력  

```sh
aws ecs list-tasks --cluster dev-ueyes-cluster | jq '.taskArns[0]'
aws ecs list-tasks --cluster dev-ueyes-cluster | jq '.taskArns | .[0]'
```

### --compact-output / -c

한줄로 출력하는 옵션  

```sh
kubectl get nodes -o json | jq -c .
{"items":[{"status":{"addresses":[{"address":"192.168.65.3","type":"InternalIP"},{"address":"docker-desktop","type":"Hostname"}]}}]}
```

### --raw-output / -r


### 조건문

```js
[{
    "name": "c1",
    "age": 23
}, {
    "name": "h2",
    "age": 33
}, {
    "name": "h3",
    "age": 36,
    'desc': 'test'
}]
```

위와같은 json 배열이 있을때 조건문을 이용해 원하는 속성만 출력


## Let's Encrypt

무료 인증서 발급 서비스  

sudo apt update
sudo apt-get install certbot letsencrypt -y


## git

자주 사용안하는 명령어만 정리

### Reset

잘못 올린 커밋 원격 리포지토리에서도 취소하기  

```sh
git reset --hard "commit id"
git push -f
```

```sh
git reset --hard origin/master
git pull origin master
```

### Reflog

실수로 `reset` 한거 되돌리기 

```sh
git reflog
git reset --hard HEAD@{3}
```

### Revase

> https://velog.io/@kwonh/Git-Rebase%EB%9E%80

짜잘하게 올린 git 통합하기

`head` 에서 2개 총 2개의 `commit` 을 합치기

```sh
git rebase -i HEAD~2
git push origin +<branch-name>
```

아래서부터가 최신, 위로 갈 수록 이전 이다.  

맨위의 `pick` 을 남기고 아래 `pick` 은 모두 `squash` 로 대채해준다.  
`pick` 밑의 여러개의 커밋에 `squash` 를 쓰면 해당 `commit` 은 `pick` 한 커밋 과 합쳐지게 된다.  
저장하고 나가면서 `commit message` 수정 인터페이스가 나오니 원하는 메세지로 대체하면 된다.(주석 빼고 다 메세지로 적용됨)

그냥 `push` 하면 이미 올라간 `history` 와 출동나서 `merge` 해야 함으로 브랜치명에 `+` 를 더해 강제로 덮어씌운다.

개인 브랜치에서 하지 않으면 충돌나기 때문에 공용으로 사용되는 공간에선 사용하면 안된다.  

### commit --amend

마지막 커밋 파일추가, 메세지 수정하기  

기존 커밋에 수정된 파일을 밀어넣고 메세지를 수정할 수 있다.  

```sh
git commit --amend
```

### commit --soft

마지막 커밋을 취소하고 변경된 파일을 다시 `stage` 로 돌리고 싶을때 사용.

`local commit` 만 사용하길 권장.

```sh
git reset --soft 97b88eb
git reset --soft HEAD^
```

### rm --cached 원격 저장소 파일 삭제  

```sh
git rm --cached .idea/modules.xml
git rm --cached -r .idea/
git commit -m "Fixed untracked files"
// 원격 저장소(origin)에 push
git push origin master
```

find . -name .DS_Store -print0 | xargs -0 git rm -f --ignore-unmatch

### checkout

commit을 원하지 않은 파일을 rollback 하고싶을때 아래와 같이 사용

```sh
git checkout {filename}
```



### .gitignore

깃허브에 올리지 말아야할 정보(OS, IDE 시스템정보 등)를 git 에 올리는 것을 방지,  

대다수의 IDE 가 프로젝트 생성시 알아서 `.gitignore` 파일을 만들어 주지만  
특수한 상황에서 직접 `.gitignore` 만들어야 할 때 아래 사이트 추천  

> <https://www.gitignore.io/>
![image26](/assets/Spring/image26.png)

위와같이 현재 사용중인 시스템 정보를 삽입하면 아래와 같은 설정이 자동으로 생성된다.  

```conf
# Created by https://www.gitignore.io/api/git,java,maven,windows,eclipse
# Edit at https://www.gitignore.io/?templates=git,java,maven,windows,eclipse

### Eclipse ###
.metadata
bin/
tmp/
*.tmp
*.bak
*.swp
*~.nib
local.properties
.settings/
.loadpath
.recommenders

# sbteclipse plugin
.target

# Tern plugin
.tern-project

# TeXlipse plugin
.texlipse

# STS (Spring Tool Suite)
.springBeans
...
...
```

이파일 내용을 `.gitignore` 파일로 저장  

### merge reequest & pull request  

`gitlab` 에선 `merge request`  
`github` 에선 `pull request`  


## OpenVPN Access Server 

재택근무로 인해 사원끼리 로컬네트워크 환경을 구축하기 위해 공인 IP 를 가진 서버에 VPN 을 구축해야 했다.  

첫번째로 시도한것이 `OpenVPN` 이지만 무료 라이센스 동시 접속자 수가 2개여서 더는 사용하지 않는다.  

그 이후로 택한것이 `Wireguard` 이며 사용하고 싶은 사용자(`peer`) 수를 지정할 수 있다.   

모든 예제는 `docker`, `docker-compose` 를 사용한다.  

두 서버 모드 `IpSec` 을 사용한 VPN 터널링이 아니기 때문에 클라이언트에 별도의 툴을 사용해 접속해야 한다.

> https://hub.docker.com/r/linuxserver/openvpn-as

비록 접속 제한이 있지만 관리 웹 서버까지 제공한다.  

```
$ docker run -d \
  --name=openvpn-as \
  --cap-add=NET_ADMIN \
  -e PUID=1000 \
  -e PGID=1000 \
  -e TZ=Asia/Seoul \
  -e INTERFACE=eth0 `#optional` \
  -p 943:943 \
  -p 9443:9443 \
  -p 1194:1194/udp \
  -v /data/openvpn-as/config:/config \
  --restart unless-stopped \
  ghcr.io/linuxserver/openvpn-as
```

컨테이너 생성이 완료되었다면 `https://YOUR_PUBLIC_IP:943/` url 접속, 기본 계정은 `admin/password`   

> https 와 943 포트를 사용해야 하며 chrome 같은 경우 보안정책으로 인해 해당 url 접근이 불가능하다. firefox 나 다른 브라우저 사용을 권장   


### 서버 설정  

로그인 후 `USER MANAGEMENT/User Permissions` 탭으로 들어가면 사용자 추가,삭제,비밀번호 설정 들을 할 수 있으니 새로운 사용자를 추가하고 `default 계정(admin)`을 삭제해도 된다.  

![vpn2](/assets/2021/vpn2.png)  

### 클라이언트 접속  

접속후 로그인시 아래같은 페이지가 출력되면 client 에 맞게 접속할 수 있다.  

![vpn1](/assets/2021/vpn1.png)  


`Mac, Windows` 의 경우 OpenVpn 에서 제공하는 GUI 툴을 사용하면 되고  

![vpn4](/assets/2021/vpn4.png)  
![vpn3](/assets/2021/vpn3.png)  


`linux` 의 경우 cli 환경 openvpn 툴과 설정파일을 다운받아 사용할 수 있다.  

관리자 페이지 접속 첫 페이지의 `Yourself(user-locked profile)` 링크를 클릭하면 해당 `서버의 IP, PORT, 사용자ID, 기타 접속 설정` 등이 미리 세팅된 `client.ovpn` 파일을 다운받을 수 있고 linux 의 경우 이 파일과 함께 아래 명령으로 접속해야 한다.  

```
$ sudo apt-get install openvpn
$ sudo openvpn client.ovpn --daemon
```


## Wireguard

> 참고: https://www.youtube.com/watch?v=GZRTnP4lyuo&t=920s

> https://hub.docker.com/r/linuxserver/wireguard  
OpenVPN 과 똑같이 `linuxserver` 에서 이미지를 만들어 주었다.  

기본적인건 위 Youtube 설정과 똑같고 `TimeZone, Peer, SERVERURL, Volumes` 설정만 본인 서버에 맞게 변경하였다.  

```yaml
version: "3"
services:
  wireguard:
    image: ghcr.io/linuxserver/wireguard
    container_name: wireguard
    cap_add:
      - NET_ADMIN
      - SYS_MODULE
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Asia/Seoul
      - SERVERURL=YOUT_PUBLIC_IP #optional
      - SERVERPORT=51820 #optional
      - PEERS=9 #optional
      - PEERDNS=auto #optional
      - INTERNAL_SUBNET=192.168.0.0 #optional
      - ALLOWEDIPS=0.0.0.0/0 #optional
    volumes:
      - /data/wireguard/config:/config
      - /data/wireguard/lib/modules:/lib/modules
    ports:
      - 51820:51820/udp
    sysctls:
      - net.ipv4.conf.all.src_valid_mark=1
    restart: always
```
```
# 컨테이너 생성 및 실행  
$ docker-compose up -d
...

# 컨테이너 동작 확인  
$ docker-compose ps
  Name      Command   State            Ports
------------------------------------------------------
wireguard   /init     Up      0.0.0.0:51820->51820/udp

# wireguard 모니터링 
$ docker exec -it wireguard wg
interface: wg0
  public key: ...
  private key: (hidden)
  listening port: 51820

peer: ...
  endpoint: 14.52.114.215:51820
  allowed ips: 192.168.0.11/32
  latest handshake: 18 minutes, 56 seconds ago
  transfer: 3.94 MiB received, 98.02 MiB sent

peer: ...
  allowed ips: 192.168.0.2/32

peer: ...
  allowed ips: 192.168.0.3/32
```

서버 설정파일 구조는 아래와 같다.  

```
$ /data/wireguard > tree
.
├── config
│   ├── coredns
│   │   └── Corefile
│   ├── peer1
│   │   ├── peer1.conf
│   │   ├── peer1.png
│   │   ├── privatekey-peer1
│   │   └── publickey-peer1
│   ...
│   ...
│   ├── peer9
│   │   ├── peer9.conf
│   │   ├── peer9.png
│   │   ├── privatekey-peer9
│   │   └── publickey-peer9
│   ├── server
│   │   ├── privatekey-server
│   │   └── publickey-server
│   ├── templates
│   │   ├── peer.conf
│   │   └── server.conf
│   └── wg0.conf
└── lib
    └── modules
```

OpenVPN 과 다르게 ID/PW 로 접속할 수 없고 설정파일 정보로만 접속할 수 있기에 별도로 설정한 건 없다.  


### 클라이언트 접속  

> https://www.wireguard.com/install/

Mac, Windows 의 경우 위 사이트에서 GUI 연결 툴 설치 가능  

SCP 를 사용하든 SFTP 를 사용하던 서버에 저장된 피어의 설정파일을 가져와야 한다.  

```
config/peer1/peer1.conf
config/peer1/peer1.png
```

> peer1.png 파일은 모바일 사용자를 위한 QR CODE 가 저장되어 있음.  

![vpn5](/assets/2021/vpn5.png)  

서버 접근이 가능하면 아래 명령어로 바로 QR CODE 출력 가능  

```
$ docker exec -it wireguard /app/show-peer 1
PEER 1 QR code:
...


리눅스의 경우 아래 명령

```
$ sudo apt-get install wireguard resloveconf
$ wg-quick up ./peer1.conf
$ wg-quick down ./peer1.conf

$ sudo mv ./peer1.conf /etc/wireguard
$ wg-quick up peer1
```
---
title:  "루비 온 레일즈, Active!"

read_time: false
share: false
author_profile: false
classes: wide

categories:
  - linux

tags:
  - ruby on rails

toc: true

---

## Active

### ActiveRecord

> https://github.com/rails/rails/blob/master/activerecord/lib/active_record/base.rb

DB에서 객체를 표시할때 `ActiveRecord::Base` 를 상속한 클래스를 사용한다.  


```rb
class ApplicationRecord < ActiveRecord::Base
  self.abstract_class = true
end

class Post < ApplicationRecord
end
```

`Action` 모듈에 정의된 객체와 마찬가지로 수많은 모듈들을 포함하고 있으며 

`Post.all`, `Post.find` 와 같은 클래스변수  
`@post.update` `@post.destroy` 와 같은 인스턴스 변수를 사용할 수 있게해준다.  

### ActiveModel

`ActiveRecord`의 하위객체에 특정 추가기능을 포함시킬 수 있도록 하는 클래스이다.  

> https://guides.rubyonrails.org/active_model_basics.html


#### ActiveModel::SecurePassword

> https://github.com/rails/rails/blob/master/activemodel/lib/active_model/secure_password.rb


이름처럼 암호화(해시)된 형식의 패스워드를 저장할 때 사용한다.  

기본적으로 `gem 'bcrypt'`를 사용하기에 `Gemfile`에 추가해야한다.  

최대 `MAX_PASSWORD_LENGTH_ALLOWED = 72`


```rb
class User < ActiveRecord::Base 
  include ActiveModel::SecurePassword
  has_secure_password
end
```

해당 모듈을 include 하게 되면 `has_secure_password`라는 클래스 메서드를 사용할 수 있다.  

위처럼 매개변수를 아무것도 삽입하지 않을경우 `:password` 심볼로 기본값 설정되고  
뒤에 `_digets`가 붙는(`password_digest`) 해시값을 가진 인스턴스 필드가 생성된다.  

> `authenticate`, `valid` 등의 메서드도 같이 사용할 수 있다.  

보통 해시화된 비밀번호를 db에 저장하기에 필드명으로 `password_digest`를 사용해야 한다.  
> 혹 `password` 접두사가 싫다면 `has_secure_password(:pwd)` 형식으로 함수 매개변수로 사용할 필드명이 담긴 매개변수를 삽입한다.  
> 물론 해시화된 값을 db 속성으로 사용하기 위해 `pwd_digest` 필드를 설정해야 한다. 위의 User 객체같은 경우 :passwrod, :
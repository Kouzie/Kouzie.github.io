---
title:  "aws 개요!"

read_time: false
share: false
author_profile: false
# # classes: wide

categories:
  - aws

toc: true
toc_sticky: true

---

# 개요

**가용영역**

리전안에 2개이상의 가용영역, 엣지 로케이션(CDN, Cache server)으로 구성
가용영역은 하나의 데이터 센터로 볼 수 있고 같은 리전의 가용영역은 물리적으로 (0 ~ 100)KM 이상 떨어져 있음  

![ddd1](/assets/2021/aws1.png)  
> https://www.youtube.com/watch?v=tvwDDM-Y-qE&list=PLfth0bK2MgIan-SzGpHIbfnCnjj583K2m&index=5

각 사용자가 바라보는 가용영역의 물리적 위치를 변경함으로 서로 섞이도록 설정된다.  


**ARN (Amazon Resource Number)**
AWS 모든 resource 의 고유 아이디
`arn:[partition]:[service]:[region]:[account_id]:[resource_type]/resource_name/(qualifier)`  
아스타링크(*) 로 다수의 resource 지정 가능  

**글로벌 서비스**
`CloudFront`  
`IAM`  
`Route53`  
`WAF`  

**지역 서비스**
`S3`  
`기타 대부분 리소스`  

**HVM (Hardware Virtual Machine)**  
하드웨어에서 직접 가상화를 지원  
![ddd1](/assets/2021/aws2.png)  
> https://www.youtube.com/watch?v=hb_4Tf6bAtY&list=PLfth0bK2MgIan-SzGpHIbfnCnjj583K2m&index=7

Guest-OS 가 하드웨어와 통신하는 것과 거의 비슷한(near bare-metal) 빠른 속도를 제공한다  

AWS 에 제공하는 EC2 에서 위 기술을 사용한다.  
![ddd1](/assets/2021/aws3.png)  


## IAM

`Identity and Access Management(IAM)` 

AWS 리소스에 대한 API 요청시 사용자의 인증, 인가를 제어하는 역할  

글로벌 서비스로 Region 별로 차이가 없음  

`IAM` 에는 `User, Group, Policy, Role` 4가지 구성요소가 있으며 간단히 아래와 같다.   

- `User`
  실제 AWS 를 사용하는 유저 혹은 어플리케이션
- `Group`
  User의 집합
- `Policy`(정책)
  User, Group 이 언제 어디서 무엇을 할 수 있는지에 대한 문서, JSON 형식으로 정의
- `Role`(역할)
  AWS 리소스에 부여되어 무엇을 할 수 있는지 정의, 


S3 를 사용할 경우 권한 체크 순서  

1. `User` 가 가지는 `Policy` 확인
2. `User` 가 속한 `Group`이 가지는 `Policy` 확인
3. `User` 가 위임된 `Role` 의 가지는 `Policy` 확인

`User`는  꼭 사용자가 아닌 다른 어플리케이션, 서비스(`Lambda`) 가 될 수 있다.  

### User 종류  

**Root User**
결제, 관리의 계정권한을 가짐, 해킹시 매우 위험하기에 사용X 권장  
Access Key, Secret Key 가 존재하지 않음으로 AWS API 호출 불가  

**IAM User**
`Root User`에 의해 생성되는 사용자 혹은 어플리케이션  
`Access Key(username)`와 `Secret Key(password)` 를 사용하여 AWS API 호출  

`Root User` 나 어드민에 준하는 `IAM User` 의 경우 MFA(멀티 팩터 인증: 다단계 인증) 을 권장  

`AdministratorAccess` - 빌링을 제외한 모든 권한을 설정하여 IAM User 생성  

## EC2

**EC2 구성 4가지**  

`인스턴스` - 가상 CPU, 메모리, 그래픽 리소스  
`EBS` - `Elastic BLock Storage`, 가상 하드디스크  
`AMI` - `Amazon Machine Image`, 인스턴스 실행을 위한 이미지, 우분투, Aws Linux 등 지원
`보안그룹` - 가상 방화벽  

기본적으로 EC2 생성시 위 4가지 구성을 설정해야 생성된다.  

### 가격모델

**On Demand**
시간(초) 측덩된 가격을 지불

**Reserved Instance(RI)**
미리 일정기간 약정하여 사용, 최대 75% 할인

**Spot Instance**
경매형식으로 남은 instance 를 구매, 최대 90% 할인
언제 종료될지 모름, 머신러닝, 빅데이터 시스템에서 효율적

**Dedicated**
전용 호스트, 실제 물리적 서버 임대
보안, 규정, 라이센스 등의 이슈가 있을 경우 사용  

**통신요금**  
외부로 나가는 트레픽에 대해서만 청구되며 내부로 들어오거나 리전간의 통신에서는 요금을 부과하지 않는다.  

**저장공간 요금**  

### 인스턴스 유형  

`Amazon EC2 m5a small`

앞의 알파벳은 인스턴스 타입(m: 유형)
숫자는 타입별 세대(5)
뒤의 접두사 아키텍쳐 타입(a: amd)
마지막은 사이즈(small)

인스턴스 타입 종류는 `t, m` 타입이 범용적으로 많이 사용됨  
![ddd1](/assets/2021/aws4.png)  
 

### EBS(Elastic BLock Storage)

EC2 에서 사용하는 가상 하드티스크로 네트워크에 연결되어 read/write 된다.  
EC2 인스턴스를 변경하는 경우에 유연하게 변경 가능  
단 같은 가용영역에 있는 경우에만 접속 가능  

인스턴스의 실행을 담당하는 `root volume` 으로 사용할 수 있으며 default 로 선택되는 스토리지 유형이다.  
인스턴스가 정지될 경우 EC2 요금은 내지 않고 EBS 요금만 내면 된다.  

> 설정을 통해 인스턴스 삭제시에 EBS 삭제를 막을 수 있다.  


아래와 같은 `EBS Type` 이 존재한다.  

![ddd1](/assets/2021/aws5.png)  

실제 aws 에서 EC2 생성시 아래와 같은 설정을 할 수 있다.   

![ddd1](/assets/2021/aws6.png)  

#### Snapshot  

EBS 를 유지할 경우에는 비용을 위해 EBS 요금을 내지 않고  
스냅샷 형식의 효율적인 형태로 S3 에 저장하여 싼 요금으로 유지할 수 있다.  

### AMI(Amazon Machine Image)

아래 4가지 중요한 요소를 가진다.  

- EBS 스냅샷  
- 인스턴스의 루트볼륨에 대한 템프릿(OS, APP)  
- 사용권한  
- 블록 디바이스 매핑(EBS 용량/개수)  

EC2 인스턴스 실행을 위한 단위 정보  
OS, 아키텍쳐, 리소스 사용량 등  
`Snapshot` 을 기반으로 `AMI` 구성이 가능하며 EC2 를 복제 및 다른 리전, 다른 계정에게 공유 가능하다.  

#### Instance Storage  

실제 EC2에 저장되는 저장공간은 네트워크 기반 `EBS` 와 인스턴스 저장 기반 `Instance Storage`으로 나뉜다.  

`Instance Storage` 는 EC2 중지, 삭제시 같이 삭제된다, 대신 속도가 빠르다.  

### 생명주기  

![ddd1](/assets/2021/aws7.png)  

인스턴스 중지중에는 EBS 요금만 청구
인스턴스 중지후 재시작시 IP 변경됨

인스턴스 재부팅시에는 IP 변경 없음  

중지와 최대절전의 차이는 메모리 내용 보존여부
최대절저은 인스턴스 사용 요금이 청구된다.  

## Auto Scaling

`Vertical Scale(Scale Up)`: 성능을 올리기 위해 하드웨어의 성능을 올리는 방식, 성능이 올라갈수록 비용이 크게 증가한다. 성능 상승의 한계가 있음  

`Horizontal Scale(Scale Out)`: 성능을 올리기 위해 하드웨어의 대수를 올리는 방식, 성능과 비용이 비례로 올라간다.  

클라우드 환경에선 스케일 아웃 방식의 오토 스케일링을 주로 사용된다.  

오토 스케일링시에 무엇을, 언제 실행시킬지 지정해야 하는데  

무엇을 실행시킬지 `EC2, AMI, IAM(보안그룹, key), 유저데이터` 등 **시작구성**을 설정하여 지정하고

언제 실행시킬지는 `CloudWatch(CPU 점유율, 인스턴스 개수), ELB(Elastic Load Balancer)` 를 통해 확인할 수 있다.  

`Instance 의 시작템플릿`, `Auto Scaling 의 Auto Scaling Group` 을 통해 다양한 설정을 할 수 있으니 참고  

## ELB(Elastic Load Balancer)

`Auto Scaling` 등을 통해 다수의 `Instance` 를 생성했을 때 로드밸런싱을 위한 서비스  

- EC2, 컨테이너, 람다함수 등으로 분산 가능   
- Health Check 등을 통해 Instance 생존여부 및 Auto Scaling 과 연동  
- IP 가 수시로 변경되어 도메인 기반으로 사용 (고정IP 사용시 네트워크 로드밸런서 사용)  

### Load Balancer 종류

- `Application Load Balancer`  
  가장 많이 사용됨  
  트래픽을 모니터링  
  URL 기반 트래픽 분산 가능  
- `Network Load Balancer`  
  TCP 기반 빠른 트래픽 분산
  Elastic IP 할당 가능(고정IP)
- `Classic Load Balancer`  
  레거시, 잘 사용되지 않음  
- `Gateway Load Balancer`  

`Gateway Load Balancer` 의 경우 아래 사진처럼 패킷을 받아 일련의 전처리 후 전달하는 역할을 한다.  
![ddd1](/assets/2021/aws8.png)  

### ALB(Application Load Balancer)

ALB 가 라우팅할 대상그룹

- Instace
- IP (Private Ip Address)
- Lambda

> 또한 ALB 다른 ALB 에게 다시 트래픽을 전달할 수 있다.  

또한 프로토콜(HTTP, HTTPS, GRPC), 기타설정(분산 알고리즘, 고정세션) 등을 설정할 수 있다.  

![ddd1](/assets/2021/aws9.png)  

위 그림처럼 `Load Balancer` 의 `Target Group`(대상 그룹)으로 `Auto Scaling Group` 을 지정할 수 있으며 `Health Check` 를 통해 연동기능또한 제공한다.  

`Auto Scaling Group` 애서 상태확인 속성에서 `ELB체크` 옵션을 통해 연동할 수 있다.   


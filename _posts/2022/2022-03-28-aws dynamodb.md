---
title:  "aws DynamoDB!"

read_time: false
share: false
author_profile: false
# # classes: wide

categories:
  - aws

toc: true
toc_sticky: true

---

## DynamoDB  

> Intro DynamoDB: <https://docs.aws.amazon.com/ko_kr/amazondynamodb/latest/developerguide/Introduction.html>

DynamoDB는 완전관리형 NoSQL 데이터베이스로 Aws 관리 하에 다운타임 또는 성능 저하 없이 테이블의 처리 능력을 확장 또는 축소할 수 있음  

### 핵심 구성 요소

DynamoDB 구성요소로 **테이블, 항목, 속성**이 있다.  

항목과 속성을 RDB 로 비유하면 
**항목은 레코드 혹은 튜플**
**속성은 필드 혹인 열**로 표현할 수 있다.  

또한 속성이 가질수 있는 타입으로는 **스칼라**(숫자, 문자열, 이진수, 부울 및 Null)와 **중첩된 속성**(객채형식) 이 있으며 최대 32 개 깊이까지 중첩 가능하다.  


### 기본 키

NoSQL 인만큼 기본키 외에는 별도의 스키마가 존재하지 않는다.  

테이블 생성시 **고유 식별자** 를 가져야 하는데 2종류로 나뉜다.  

**1. 파티션 키**  
일반적으로 사용하는 단순 기본 키를 가리키며 해시 함수 출력에 따라 항목을 저장할 물리적 파티션(SSD 스토리지)이 결정된다.  

**2. 복합 키**
복합키로 부르는 이 형식은 **파티션 키와 정렬 키**로 구성된다.  
해시 함수에 대한 입력으로 파티션 키 값을 기준으로 파티션을 나누고, 파티션 키 값이 동일한 모든 항목은 정렬 키 값을 기준으로 정렬되어 함께 저장된다.  
여러 항목이 동일한 파티션 키 값을 가질수 있지만 동일한 파티션 내에서 고유의 정렬 키값을 가져야 한다.  


각 기본 키 속성은 스칼라여야 하며 문자열, 숫자 또는 이진수 가 포함된다.  

### 보조 인덱스 (Secondary Index)

테이블당 하나 이상의 **보조 인덱스(Secondary Index)** 생성 가능하다.    
보조 인덱스를 생성게 되면 데이터 access 방면에서 편리하다.  

예로 왼쪽의 `Music` 은 복합 키를 사용하는 테이블로  
`Aritst` 를 파티션 키, `SongTitle` 을 정렬키로 사용하는 테이블이다

![ddd1](/assets/2022/dynamodb1.png)  

`Music` 테이블로부터 오른쪽의 `GenreAlbumTitle` 라는 인덱스를 생성하였는데  
`Genre` 는 파티션 키이고, `AlbumTitle` 은 정렬 키로 사용했고 원본 `Music` 의 복합키를 가져왔다(프로젝션).  

이제 `Genre` 와 `AlbumTitle` 속성을 가지고도 테이블 데이터를 쿼리할 수 있게 되었다.  
`AlbumTitle`이 알파벳 `H`로 시작하는 모든 Country 앨범을 검색하는 조건을 지정할 수 도 있다.  

모든 인덱스는 원본 테이블로부터 생성되는 이 원본 테이블을 **기본테이블** 이라 한다.  
인덱스의 생성 방식을 토대로 2종류로 나누는데 아래와 같다.   

**1. Global Secondary Index(GSI)**  
기본테이블의 파티션 키 및 정렬 키가 다를 수 있는 인덱스입니다.

**2. Local Secondary Index(LSI)**
기본테이블의 파티션 키는 동일하지만 정렬 키가 다른 인덱스입니다.

DynamoDB의 각 테이블에는 기본 할당량으로 `GSI` 20개, `LSI` 5개의 할당량이 있으며 인덱스를 자동으로 유지 관리한다.  
기본테이블에 항목을 추가, 변경하면 DynamoDB는 테이블의 모든 인덱스에서 해당 항목을 추가, 업데이트 또는 삭제된다.  

## DynamoDB API 

DynamoDB 에 저장된 데이터, 그중 테이블의 데이터 영역을 조회하기 위해 여러가지 방법이 있는데  
`클래식 CRUD API` 를 호출하거나 `PartiQL` 언어를 사용해 데이터 영역을 CRUD 한다.  

`클래식 CRUD API` 의 경우 REST API 형식과 유사하고   
`PartiQL` 의 경우 RDBMS 에서 사용하면 SQL 언어와 유사하다.  

또한 DynamoDB 는 트랜잭션 기능을 지원하는데 이때문에 아래 2가지 읽기 방식이 존재한다.  

**최종적 일관된 읽기(Eventually Consistent Read)**  
최근 완료된 쓰기 작업의 결과가 반영되지 않을 수 있다.  

**강력한 일관된 읽기(Strongly Consistent Read)**  
가장 최신 데이터를 포함하여 응답한다. 단 네트워크 지연 또는 중단이 발생할 경우 HTTP 500 에러가 반환되거나 속도가 지연될 수 있다.  
또한 `GSI` 에서는 강력히 일관된 읽기가 지원되지 않는다.  




### PartiQL

> PartiQL - Amazon DynamoDB용 SQL 호환 쿼리 언어
> https://docs.aws.amazon.com/ko_kr/amazondynamodb/latest/developerguide/ql-reference.html



## 요금  

`온디맨드`, `프로비저닝됨` 요금제가 존재하며 24 시간마다 변경 가능하다.  


### 온디맨드

온디맨드는 트래픽 예측이 불가능할 경우, 용량 계획 없이 많은 요청을 처리해야 할 경우 유용한 요금제이다.  
한자리수 밀리초 지연시간을 제공하며 실제 데이터를 읽고 쓴 만큼 요금을 지불한다.  

`최종적 일관된 읽기` 의 경우 4KB, `강력한 일관된 읽기` 의 경우 2KB 
쓰기의 경우 1KB 를 1회로 지정한다.  

### 프로비저닝  

어플리케이션별로 초당 읽기/쓰기 횟수를 지정하여 사용하는 방식  
애플리케이션 트래픽이 예측 가능한 경우 사용한다.  

용량에 대해 상한, 하한을 지정할 수 있으며 사용량을 선결제(예약) 하는등의 작업이 가능하다.  





## DynamoDB Streams

DynamoDB Streams는 DynamoDB 테이블의 데이터 수정 이벤트를 캡처하는 선택적 기능입니다. 이러한 이벤트에 대한 데이터가 이벤트가 발생한 순서대로 거의 실시간으로 스트림에 표시됩니다.

각 이벤트는 스트림 레코드에 의해 나타납니다. 테이블에서 스트림을 활성화하면 다음과 같은 이벤트 중 하나가 발생할 때마다 DynamoDB Streams가 스트림 레코드를 기록합니다.

테이블에 새로운 항목이 추가되면 스트림이 해당 속성을 모두 포함하여 전체 항목의 이미지를 캡처합니다.

항목이 업데이트되면 스트림이 항목에서 수정된 속성의 "사전" 및 "사후" 이미지를 캡처합니다.

테이블에서 항목이 삭제되면 스트림이 항목이 삭제되기 전에 전체 항목의 이미지를 캡처합니다.

각 스트림 레코드에는 또한 테이블의 이름, 이벤트 타임스탬프 및 다른 메타데이터가 포함되어 있습니다. 스트림 레코드의 수명은 24시간이며, 24시간이 지나면 스트림에서 자동으로 제거됩니다.

DynamoDB Streams를 AWS Lambda와 함께 사용하면 트리거, 즉 관심 있는 이벤트가 스트림에 나타날 때마다 자동으로 실행되는 코드를 생성할 수 있습니다. 예를 들어, 회사의 고객 정보가 들어 있는 Customers 테이블을 생각해 볼 수 있습니다. 새 고객마다 "환영" 이메일을 보내려고 한다고 가정해 보십시오. 해당 테이블에 스트림을 활성화한 다음, 스트림을 Lambda 함수와 연결할 수 있습니다. Lambda 함수는 새로운 스트림 레코드가 표시될 때마다 실행되지만, Customers 테이블에 추가된 새로운 항목만 처리합니다. EmailAddress 속성이 있는 모든 항목에 대해 Lambda 함수는 Amazon Simple Email Service(Amazon SES)를 호출하여 해당 주소에 이메일을 보냅니다.


-- 작성중 -- 
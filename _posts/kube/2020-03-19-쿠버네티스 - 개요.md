---
title:  "ì¿ ë²„ë„¤í‹°ìŠ¤ - ê°œìš”!"

read_time: false
share: false
author_profile: false
toc: true
toc_sticky: true
# classes: wide

categories:
  - kubernetes
---


# ì¿ ë²„ë„¤í‹°ìŠ¤

êµ¬ê¸€ì—ì„œ ìŠ¤íƒ€íŠ¸í•œ ì˜¤í”ˆì†ŒìŠ¤ë¡œ êµ¬ì„±ëœ ì»¨í…Œì´ë„ˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ íˆ´.  

ì»¨í…Œì´ë„ˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ íˆ´ì€ ì¿ ë²„ë„¤í‹°ìŠ¤ ì™¸ì—ë„ Amazone ECS, ë„ì»¤ ìŠ¤ì›œ, ì•„ë§ˆì¹˜ ë…¸ë§ˆë“œ, ì•„íŒŒì¹˜ Mesos ë“±ì´ ìˆë‹¤.  

ì´ì¤‘ì—ì„œ ê°€ì¥ ì¸ê¸°ìˆëŠ” ì»¨í…Œì´ë„ˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ íˆ´ì´ ì¿ ë²„ë„¤í‹°ìŠ¤ì´ë‹¤.  

## docker desktop

ì¿ ë²„ë„¤í‹°ìŠ¤ ì‹¤ìŠµìš©ìœ¼ë¡œ ì‹¤ì œ í´ëŸ¬ìŠ¤í„°ìš© PC ë¥¼ ì—¬ëŸ¬ëŒ€ êµ¬ë§¤í•˜ì—¬ êµ¬ì¶•í•˜ë©´ ì¢‹ê² ì§€ë§Œ   
mac, window ë“±ì˜ ë„ì»¤ ì„¤ì¹˜ì‹œ `docker desktop` ìœ¼ë¡œ ì„¤ì¹˜í•˜ë©´ ì¿ ë²„ë„¤í‹°ìŠ¤ë¥¼ ì‰½ê²Œ ì‚¬ìš© ê°€ëŠ¥í•˜ë‹¤.  

![kube7](/assets/kube/kube7.png)  

> ë³„ë‹¤ë¥¸ ì´ìœ ê°€ ì—†ë‹¤ë©´ `docker desktop` ì„ ì‚¬ìš©í•˜ëŠ”ê²ƒì„ ì¶”ì²œ

## minikube ì„¤ì¹˜

`minikube` ë¼ëŠ” íˆ´ë¡œë„ ê°€ìƒìœ¼ë¡œ ë¡œì»¬í”¼ì‹œì— í™˜ê²½ êµ¬ì¶•ì´ ê°€ëŠ¥í•˜ë‹¤.  

ê°€ìƒí™˜ê²½ì€ ê¸°ë³¸ì ìœ¼ë¡œ `docker` ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ì„¤ì •í•œë‹¤.  

```
$ brew install minikube
$ minikube start --driver=docker
ğŸ˜„  Darwin 10.15.4 ìœ„ì˜ minikube v1.9.2
...
ğŸ„  ëë‚¬ìŠµë‹ˆë‹¤! ì´ì œ kubectl ì´ "minikube" ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤
$ minikube config set driver docker # docker ë¥¼ ê¸°ë³¸ ê°€ìƒë“œë¼ì´ë²„ë¡œ ì„¤ì •  
```

ì‹¤í–‰ëœ `minikube` ìƒíƒœ ì¡°íšŒ  

```
$ minikube status
m01
host: Running
kubelet: Running
apiserver: Running
kubeconfig: Configured

$ docker ps
CONTAINER ID        IMAGE                                COMMAND                  CREATED             STATUS              PORTS                                                                           NAMES
2f61e951c809        gcr.io/k8s-minikube/kicbase:v0.0.8   "/usr/local/bin/entrâ€¦"   13 minutes ago      Up 10 minutes       127.0.0.1:32773->22/tcp, 127.0.0.1:32772->2376/tcp, 127.0.0.1:32771->8443/tcp   minikube

$ minikube stop
$ minikube start
```

`kubectl` ëª…ë ¹ì„ í†µí•´ ë¡œì»¬ì— ì„¤ì¹˜ëœ í´ëŸ¬ìŠ¤í„°ë¥¼ ì¡°ì‘ ê°€ëŠ¥í•˜ë‹¤.  

```
$ kubectl get node -o=wide
NAME       STATUS   ROLES    AGE     VERSION   INTERNAL-IP   EXTERNAL-IP   OS-IMAGE       KERNEL-VERSION     CONTAINER-RUNTIME
minikube   Ready    master   4m25s   v1.18.0   172.17.0.2    <none>        Ubuntu 19.10   4.19.76-linuxkit   docker://19.3.2
$ kubectl version --output yaml # ë²„ì „ í™•ì¸
```


<!-- 
## ì¿ ë²„ë„¤í‹°ìŠ¤ ì„¤ì¹˜ - kubeadm

> https://kubernetes.io/ko/docs/setup/production-environment/tools/

ëŒ€ë¶€ë¶„ì˜ í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤ ì—…ì²´ì—ì„œ ìì²´ ìš´ì˜ í´ëŸ¬ìŠ¤í„°ë¥¼ ì œê³µí•˜ì§€ë§Œ
ë¡œì»¬ PC ì—¬ëŸ¬ëŒ€ë¡œ ì¿ ë²„ë„¤í‹°ìŠ¤ êµ¬ì¶•ì‹œì— ìœ„ì˜ íˆ´ì„ ì‚¬ìš©í•˜ì—¬ ì‰½ê²Œ êµ¬ì¶• ê°€ëŠ¥í•¨.  

> https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/
`kubeadm` - ì¿ ë²„ë„¤í‹°ìŠ¤ ê³µì‹ í´ëŸ¬ìŠ¤í„° ìƒì„±/ê´€ë¦¬ ë„êµ¬  

> https://medium.com/finda-tech/overview-8d169b2a54ff



### ì‚¬ì „ ì„¤ì •  

```
$ sudo modprobe br_netfilter # ì»¤ë„ ëª¨ë“ˆ ì ì¬ - 

$ sudo swapoff -a # ìŠ¤ì™‘ ë¹„í™œì„± 

$ lsmod | grep br_netfilter  # br_netfilter ì»¤ë„ ëª¨ë“ˆì´ ì˜¬ë¼ê°€ìˆëŠ”ì§€ í™•ì¸
br_netfilter           28672  0
bridge                176128  1 br_netfilter

$ cat <<EOF | sudo tee /etc/sysctl.d/k8s.conf
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
EOF

$ sudo sysctl --system
```

> `br_netfilter` - ë¸Œë¦¿ì§€ë¥¼ í†µí•´ ì „ë‹¬ë˜ëŠ” íŒ¨í‚·ì´ `iptables` ì— ì œì–´ë¨, `Pod` ê°„ í†µì‹ ì‹œ í•„ìš”  
> `/etc/sysctl.d/k8s.conf` íŒŒì¼ ì—­ì‹œ ë¸Œë¦¿ì§€ê°„ íŒ¨í‚· í†µì‹ ì„ ìœ„í•œ ì„¤ì •íŒŒì¼  

```
$ curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add -
$ cat <<EOF | sudo tee /etc/apt/sources.list.d/kubernetes.list
deb https://apt.kubernetes.io/ kubernetes-xenial main
EOF
```

> `gpg` ì„¤ì • ë° `apt list` ì¶”ê°€  

```
$ sudo apt-get update && sudo apt-get install -y apt-transport-https curl
$ sudo apt-get install -y kubelet kubeadm kubectl
$ sudo apt-mark hold kubelet kubeadm kubectl
```

> `kubelet` `kubeadm` `kubectl` ì„¤ì¹˜  


```
$ sudo kubeadm init --pod-network-cidr=172.28.0.0/14
```

> ë„¤íŠ¸ì›Œí¬ ëŒ€ì—­ ì„¤ì • 

### kubectl ë“±ë¡  

```
$ mkdir -p $HOME/.kube
$ sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
$ sudo chown $(id -u):$(id -g) $HOME/.kube/config
```

> `kubectl` ì„ í†µí•´ ì»¨íŠ¸ë¡¤ í•˜ê³  ì‹¶ì€ pc ì— ìœ„ ëª…ë ¹ì–´ ì‚½ì… 

```
$ sudo kubeadm token list
TOKEN                     TTL         EXPIRES                     USAGES                   DESCRIPTION                                                EXTRA GROUPS
<TOKEN-VALUE>             23h         kube-10-27T14:07:05+09:00   authentication,signing   The default bootstrap token generated by 'kubeadm init'.   system:bootstrappers:kubeadm:default-node-token
```

> `kube master` ì—ì„œ í† í°ê³¼ `hash` ê°’ í™•ì¸  

```
$ openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2>/dev/null | openssl dgst -sha256 -hex | sed 's/^.* //'
<SHA-256 HASH-VALUE>
```

### ë…¸ë“œ ì¶”ê°€

```
$ sudo swapoff -a
$ sudo kubeadm join 192.168.10.235:6443 --token <TOKEN-VALUE> \
    --discovery-token-ca-cert-hash sha256:<SHA-256 HASH-VALUE>
```
 -->


## k8s cli tool - kubectl 

ë§ˆìŠ¤í„° ì»´í¬ë„ŒíŠ¸ ì¤‘ í•˜ë‚˜ì¸ `API Server` ì™€ í†µì‹ í•˜ê¸° ìœ„í•´ `kubectl` ëª…ë ¹ì„ ì‚¬ìš©í•œë‹¤.   
`kubectl` ê³¼ `API Server`ê°€ ì–´ë–»ê²Œ ì—°ê²°ë˜ì–´ ìˆëŠ”ì§€ ì•Œì•„ë³´ì.  

```
$ ls ~/.kube
cache      config     http-cache
```

```yaml
clusters:
- cluster:
    certificate-authority: /Users/gojiyong/.minikube/ca.crt
    server: https://127.0.0.1:32768
  name: minikube 
# kubectl ëª…ë ¹ ì‹¤í–‰ì‹œ ì‚¬ìš©í•  í´ëŸ¬ìŠ¤í„° ì •ë³´

contexts:
- context:
    cluster: minikube
    user: minikube
  name: minikube
current-context: minikube
kind: Config
preferences: {}
# í´ëŸ¬ìŠ¤í„° ì‚¬ìš©ì ì •ë³´ context, 

users:
- name: minikube
  user:
    client-certificate: /Users/gojiyong/.minikube/profiles/minikube/client.crt
	client-key: /Users/gojiyong/.minikube/profiles/minikube/client.key
# ì—‘ì„¸ìŠ¤ í•˜ëŠ” ì‚¬ìš©ì ì •ë³´ - í´ëŸ¬ìŠ¤í„° ì—‘ì„¸ìŠ¤ë¥¼ ìœ„í•œ ì¸ì¦ í‚¤ ë“± ì„¤ì •  
```



# ì¿ ë²„ë„¤í‹°ìŠ¤ ì•„í‚¤í…ì²˜

![kube1](/assets/kube/kube1.png)  

ì¿ ë²„ë„¤í‹°ìŠ¤ëŠ” ì•„í‚¤í…ì²˜ëŠ” ì „ì²´ì ìœ¼ë¡œ `master` ì™€ `node` ë¡œ êµ¬ì„±ë˜ë©°  
ë‚´ë¶€ì—ì„œ ì—­í• ì— ë§ëŠ” ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ë¥¼ ê°€ì§„ë‹¤.  

## ë§ˆìŠ¤í„°

ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„° ì „ì²´ë¥¼ ê´€ë¦¬í•˜ëŠ” ì—­í•    
ì—¬ëŸ¬ëŒ€ì˜ í´ëŸ¬ìŠ¤í„° ë…¸ë“œì˜ ë¦¬ì†ŒìŠ¤ ìƒí™© íŒŒì•…, ì»¨í…Œì´ë„ˆë¥¼ ê°€ë™ì‹œí‚¬ ë…¸ë“œë¥¼ ì„ íƒ  

`etcd` ë¼ëŠ” ë¶„ì‚° `Key-value store` ë¥¼ ì‚¬ìš©í•´ í´ëŸ¬ìŠ¤í„° êµ¬ì„±ì •ë³´ë¥¼ ê´€ë¦¬  

> `/etc` + `distribute` ì˜ ì•½ì–´. 
> ë ˆë“œí—·ì—ì„œ ì„¤ì •íŒŒì¼ì„ ì„œë²„ê°„ ê³µìœ í•˜ê¸° ìœ„í•´ ë§Œë“  íˆ´ì„ ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œ ìŠ¹ê³„í•¨.  



## ë…¸ë“œ

> https://kubernetes.io/ko/docs/tutorials/kubernetes-basics/explore/explore-intro/

ì»¨í…Œì´ë„ˆê°€ ì‘ë™ë˜ëŠ” ì„œë²„, ì—¬ëŸ¬ëŒ€ì˜ ë…¸ë“œë¥¼ ì¤€ë¹„í•´ í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì„±,  
ë…¸ë“œëŠ” í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤ íšŒì‚¬ì˜ ê°€ìƒ ë¨¸ì‹  í˜¹ì€ ë¬¼ë¦¬ ë¨¸ì‹ ì´ ë…¸ë“œì—­í• ì„ í•œë‹¤.  

í•´ë‹¹ ë…¸ë“œì•ˆì—ì„œ ì—¬ëŸ¬ëŒ€ì˜ ì»¨í…Œì´ë„ˆ(ì¼ë°˜ì ìœ¼ë¡œ ë„ì»¤)ê°€ ë™ì‘  


# ì¿ ë²„ë„¤í‹°ìŠ¤ ì»´í¬ë„ŒíŠ¸

> https://kubernetes.io/ko/docs/concepts/overview/components/

ë§ˆìŠ¤í„°ì™€ ë…¸ë“œëŠ” ë‚´ë¶€ì—ì„œ ê°ì¢… ë™ì‘ì„ í•˜ëŠ” ì»´í¬ë„ŒíŠ¸(ë…¸ë“œ, ë§ˆìŠ¤í„°)ë“¤ì´ ì¡´ì¬í•œë‹¤.

## ë§ˆìŠ¤í„° ì»´í¬ë„ŒíŠ¸

**API Server** - ì¿ ë²„ì˜ ë¦¬ì†ŒìŠ¤ ì •ë³´ë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•œ Rest API ì•¤ë“œí¬ì¸íŠ¸ ì„œë²„,  
ê° ì»´í¬ë„ŒíŠ¸ë¡œë¶€í„° ì •ë³´ë¥¼ ë°›ì•„ `etcd` ì— ì €ì¥, ì»´í¬ë„ŒíŠ¸ê°„ í†µì‹ , ë…¸ë“œê°„ í†µì‹ ì„ ì§€ì›í•œë‹¤.  
ê·¸ë¦¼ì„ ë³´ë©´ ëª¨ë“  ì»´í¬ë„ŒíŠ¸ë“¤ì´ `API Server` ë¥¼ í†µí•´ í†µì‹ í•˜ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆìŒ.  
`kubectl` ëª…ë ¹ ë˜í•œ `API Server` ë¥¼ í†µí•´ ì „íŒŒëœë‹¤.  

**ë°ì´í„° ìŠ¤í† ì–´(etcd)** - í´ëŸ¬ìŠ¤í„°ì˜ êµ¬ì„±ì„ ìœ ì§€í•˜ëŠ” ë¶„ì‚° `key-value store`, ë…¸ë“œì˜ ìƒíƒœì •ë³´, ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œ í•„ìš”í•œ ëª¨ë“  ì„¤ì • ì •ë³´ê°€ ë“¤ì–´ê°€ ìˆìœ¼ë©° `API Server` ê°€ ì´ë¥¼ ì°¸ì¡°í•´ ê° ì»´í¬ë„ŒíŠ¸ê°€ ë™ì‘í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤Œ,  
ì¤‘ìš”í•œ ë°ì´í„°ì´ê¸°ì— ë°±ì—…, ë³„ë„ì˜ ì„œë²„ë“¤ì— ë¶„ì‚°ì‹¤í–‰ í•œë‹¤.  

**ìŠ¤ì¼€ì¤„ëŸ¬** - íŒŒë“œë¥¼ ì–´ëŠ ë…¸ë“œì—ì„œ ì‘ë™ì‹œí‚¬ì§€ë¥¼ ì œì–´í•˜ëŠ” ë°±ì•¤ë“œ ì»´í¬ë„ŒíŠ¸, `API Server` ì™€ í†µì‹ í•˜ë©° í´ëŸ¬ìŠ¤í„° ìƒíƒœë¥¼ í™•ì¸, ë¹ˆê³µê°„ì˜ ë…¸ë“œì— íŒŒë“œë¥¼ í• ë‹¹ ë° ì‹¤í–‰í•˜ëŠ” ìŠ¤ì¼€ì¤„ë§ì„ ì²˜ë¦¬í•œë‹¤.  

**ì»¨íŠ¸ë¡¤ëŸ¬ ë§¤ë‹ˆì €** - íŒŒë“œë¥¼ ê´€ë¦¬í•˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ë“¤ì´ ê³³ê³³ì— ë°°ì¹˜ë˜ì–´ ìˆê³  ì´ ì»¨íŠ¸ë¡¤ëŸ¬ ê°ê°ì„ ì‹¤í–‰í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ê°€ ì»¨íŠ¸ë¡¤ëŸ¬ ë§¤ë‹ˆì €. í´ëŸ¬ìŠ¤í„°ì˜ ìƒíƒœë¥¼ ê°ì‹œ, í•­ìƒ ì •ìƒìƒíƒœë¥¼ ìœ ì§€ì‹œí‚¤ëŠ” ë°±ì•¤ë“œ ì»´í¬ë„ŒíŠ¸

## ë…¸ë“œ ì»´í¬ë„ŒíŠ¸

**kubelet** - ë…¸ë“œ ë‚´ë¶€ì—ì„  `kubelet` ì´ë¼ëŠ” ì—ì´ì „íŠ¸ê°€ ì›€ì§ì´ë©° ì»¨í…Œì´ë„ˆ(íŒŒë“œ)ë¥¼ ì‹¤í–‰, í—¬ìŠ¤ì²´í¬ í•œë‹¤.  
ë…¸ë“œì˜ `status` ë¥¼ ì •ê¸°ì ìœ¼ë¡œ ê°ì‹œí•˜ë©° ì´ë¥¼ `API Server` ë¡œ ì „ì†¡, `etcd` ì— ì €ì¥ë˜ë„ë¡ ì§€ì›.    

**kube-proxy** - í´ëŸ¬ìŠ¤í„° ì•ˆì˜ ë³„ë„ì˜ ê°€ìƒ ë„¤íŠ¸ì›Œí¬ ì„¤ì •, ë…¸ë“œë¡œ ë“¤ì–´ì˜¤ëŠ” íŒ¨í‚·ì„ ì ì ˆí•œ ì»¨í…Œì´ë„ˆ(íŒŒë“œ)ë¡œ ë¼ìš°íŒ…, ë¡œë“œë°¸ëŸ°ì‹± ë“±ì˜ ë™ì‘ì„ ê´€ë¦¬í•˜ëŠ” ì»´í¬ë„ŒíŠ¸

# ì¿ ë²„ë„¤í‹°ìŠ¤ ë¦¬ì†ŒìŠ¤

## íŒŒë“œ(Pod)

> https://kubernetes.io/ko/docs/concepts/workloads/pods/

`k8s` ì—ì„  ì—¬ëŸ¬ê°œì˜ ì»¨í…Œì´ë„ˆë¥¼ ëª¨ì•„ íŒŒë“œë¡œ ê´€ë¦¬í•œë‹¤.  

![kube2](/assets/kube/kube2.png){: .shadow}{: width="400"} 

íŒŒë“œ ë‚´ë¶€ì—ì„œ ì›¹ì„œë²„ìš©, íŒŒì¼ì„œë²„ìš©, í”„ë¡ì‹œ ì„œë²„ìš© ë„ì»¤ ì»¨í…Œì´ë„ˆ ì—¬ëŸ¬ê°œë¥¼ ëª¨ì•„ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤.  
ì¿ ë²„ì—ì„  ì´ íŒŒë“œê°€ ì•± ë””í”Œë¡œì´ ë‹¨ìœ„ê°€ ë˜ë©° íŒŒë“œ ë‹¨ìœ„ë¡œ ì»¨í…Œì´ë„ˆ ì‘ì„±, ì‹œì‘, ì •ì§€, ì‚­ì œ ë“±ì˜ ì¡°ì‘ì„ ì§„í–‰í•œë‹¤.  

íŒŒë“œëŠ” í•­ìƒ í•˜ë‚˜ì˜ ë…¸ë“œì— ë°°ì¹˜ë˜ë©° íŒŒë“œê°€ ìª¼ê°œì§ˆ ìˆœ ì—†ë‹¤.  

ë”°ë¼ì„œ íŒŒë“œ ë‚´ë¶€ì—ì„œ ê°€ìƒ ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ ì¹´ë“œ(**ì‚¬ì„¤IP**)ë¥¼ ê° ì»¨í…Œì´ë„ˆì—ê²Œ ë°œê¸‰í•˜ë©° ì„œë¡œ ê°™ì€ ë„¤íŠ¸ì›Œí¬ ì•ˆì— ìˆìŒìœ¼ë¡œ `localhost` ë¥¼ í†µí•´ í†µì‹  ê°€ëŠ¥í•˜ë‹¤.  

## ë¦¬í”Œë¦¬ì¹´ ì…‹(Replica Set)

> https://kubernetes.io/ko/docs/concepts/workloads/controllers/replicaset/

**í´ëŸ¬ìŠ¤í„° ì•ˆì—ì„œ ê°€ë™ë˜ëŠ” íŒŒë“œ ìˆ˜ë¥¼ ê´€ë¦¬í•˜ëŠ” ë¦¬ì†ŒìŠ¤**

í´ëŸ¬ìŠ¤í„° ì•ˆì— ì§€ì •ëœ ìˆ˜ì˜ íŒŒë“œë¥¼ ì¼ì •í•˜ê²Œ ìœ ì§€í•˜ë©° ì¥ì• ëŒ€ì‘ ë° ìë™ ì‹¤í–‰í•˜ëŠ” ì—­í• .  

## ë””í”Œë¡œì´ë¨¼íŠ¸(Deployment)

> https://kubernetes.io/ko/docs/concepts/workloads/controllers/deployment/

**ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬ ë²„ì „ ë‹¨ìœ„ë¥¼ ê´€ë¦¬í•˜ëŠ” ë¦¬ì†ŒìŠ¤**. 

íŒŒë“œì•ˆì˜ ì»¨í…Œì´ë„ˆë¥¼ ë²„ì „ì—… í•˜ê³  ì‹¶ì„ ë•Œ ì‹œìŠ¤í…œì„ ì •ì§€ì‹œí‚¤ì§€ ì•Šê³  ë²„ì „ì—…(ë¡¤ë§ì—…ë°ì´íŠ¸), ë¡¤ë°± ê¸°ëŠ¥ ë“±ì„ ì œê³µí•œë‹¤.  

## ë°ëª¬ ì…‹(Daemon Set)

> https://kubernetes.io/ko/docs/concepts/workloads/controllers/daemonset/

**íŠ¹ì •ë…¸ë“œ í˜¹ì€ ëª¨ë“  ë…¸ë“œì— í•­ìƒ ì‹¤í–‰ë˜ì–´ì•¼í•  íŠ¹ì • ì»¨í…Œì´ë„ˆ(íŒŒë“œ)ë¥¼ ê´€ë¦¬í•˜ëŠ” ë¦¬ì†ŒìŠ¤**

ë§ˆìŠ¤í„° ë…¸ë“œì˜ ìŠ¤ì¼€ì¤„ëŸ¬ì— ì˜í–¥ì„ ë°›ì§€ ì•Šê³  ì§€ì •í•œ ë…¸ë“œì—ì„œ ì»¨í…Œì´ë„ˆë¥¼ ë™ì‘ì‹œí‚¤ê³  ì‹¶ì„ë•Œ ì‚¬ìš©í•œë‹¤.

ì˜ˆë¥¼ë“¤ì–´ ë¡œê·¸ì½œë ‰í„°, ëª¨ë‹ˆí„°ë§ ê¸°ëŠ¥ì„ í•˜ëŠ” ì»¨í…Œì´ë„ˆ(íŒŒë“œ)ëŠ” ë…¸ë“œë‹¹ í•˜ë‚˜ì”© ì‘ë™ì‹œí‚¤ê³  ì‹¶ì€ ê²½ìš°ê°€ ìˆëŠ”ë° ì´ë•Œ ë°ëª¬ì…‹ì„ ì‚¬ìš©í•œë‹¤.  

> `kube-proxy` ë˜í•œ ë°ëª¬ ì…‹ì„ ì‚¬ìš©í•´ ê°€ë™ëœë‹¤.  

## ìŠ¤í…Œì´íŠ¸í’€ ì…‹(Stateful Set)

**ê³ ì •ëœ ìƒíƒœ(Stateful) ì„ ìš”êµ¬í•˜ëŠ” ì»¨í…Œì´ë„ˆ(íŒŒë“œ)ë¥¼ ê´€ë¦¬í•˜ëŠ” ë¦¬ì†ŒìŠ¤**

> https://kubernetes.io/ko/docs/concepts/workloads/controllers/statefulset/

ì»¨í…Œì´ë„ˆëŠ” `stateless` ë¡œ ì‹¤í–‰ëœë‹¤, ì–´ë–¤ ë…¸ë“œì—ì„œ ì–´ë–¤ IP ë¥¼ ê°€ì§€ê³  ì‹¤í–‰ë ì§€ ëª¨ë¥¸ë‹¤ëŠ” ëœ»ì´ë‹¤.  
DBì™€ ê°™ì€ ê³ ì •ëœ ìƒíƒœ(Stateful)ë¥¼ í•„ìš”ë¡œ í•˜ëŠ” ì»¨í…Œì´ë„ˆì˜ ê²½ìš° **ìŠ¤í…Œì´íŠ¸í’€ ì…‹** ë¥¼ ì‚¬ìš©í•œë‹¤.

ì•ˆì •ì„±, ê³ ì •ì„±, ì§€ì†ì„± ì„ ë³´ì¦í•œë‹¤.  

# ë§¤ë‹ˆí˜ìŠ¤íŠ¸ íŒŒì¼(Manifest file, í…œí”Œë¦¿)

> Manifest: ì„ ì–¸ì„œ

í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì—ì„œ ì›€ì§ì´ëŠ” ì»¨í…Œì´ë„ˆ, ë„¤íŠ¸ì›Œí¬, ì¡ ë“±ì˜ **ì¿ ë²„ë„¤í‹°ìŠ¤ ë¦¬ì†ŒìŠ¤ë¥¼ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ íŒŒì¼ì„ í†µí•´ ê´€ë¦¬í•œë‹¤.**

`yaml`, `json` í˜•ì‹ì˜ íŒŒì¼ë¡œ êµ¬ì„±ëœë‹¤.   

k8s ì˜ ëª¨ë“  ë¦¬ì†ŒìŠ¤ëŠ” ë§¤ë‹ˆí˜ìŠ¤íŠ¸ íŒŒì¼ì„ í†µí•´ ì´ë£¨ì–´ì§€ê¸° ë•Œë¬¸ì—  
ë¦¬ì†ŒìŠ¤ë³„ ë¬¸ë²•ì„ ìµí˜€ì•¼ í•œë‹¤.  

```yaml
# webserver.yaml
apiVersion: apps/v1 # api ë²„ì „ ì •ë³´ - í˜¸ì¶œí•  api ë²„ì „ ì§€ì •, kubectl api-versions ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë²„ì „ í™•ì¸ ê°€ëŠ¥.
kind: ReplicaSet # ì¿ ë²„ ë¦¬ì†ŒìŠ¤ ì¢…ë¥˜ - Pod, ReplicaSet, Service, ConfigMap, Job ë“±ë“±
metadata: # í•´ë‹¹ ì˜¤ë¸Œì íŠ¸ ì´ë¦„, ë ˆì´ë¸” ì§€ì •
  name: webserver # ë¦¬ì†ŒìŠ¤ ì´ë¦„ - kubectl ëª…ë ¹ìœ¼ë¡œ ì¡°ì‘í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ì´ë¦„
spec: # ë¦¬ì†ŒìŠ¤ì˜ ìƒì„¸ ì •ë³´, ì‹¤í–‰ ë™ì‘ ë°©ì‹ ë“±ì„ ì§€ì •, ì•„ë˜ëŠ” kind = ReplicaSet ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ ì†ì„±ë“¤  
  replicas: 10
  selector:
    matchLabels:
      app: webfront
  template:
    metadata:
      labels:
        app: webfront
    spec:
      containers:
      - image: nginx
        name: webfront-container
        ports:
          - containerPort: 80
```

ìœ„ì™€ ê°™ì´ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ íŒŒì¼ì„ ì‚¬ìš©í•´ ì¿ ë²„ë„¤í‹°ìŠ¤ ë¦¬ì†ŒìŠ¤ ìƒì„±, ì‚­ì œê°€ëŠ¥  

```
$ kubectl apply -f webserver.yaml
replicaset.apps/webserver created

$ kubectl delete -f webserver.yaml
replicaset.apps "webserver" deleted
```

ë§¤ë‹ˆí˜ìŠ¤íŠ¸ íŒŒì¼ì˜ ì •ë³´ëŠ” `etcd` ì— ì €ì¥ë˜ê³  ê´€ë¦¬í•œë‹¤.  
`kuberctl` ëª…ë ¹ìœ¼ë¡œ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ íŒŒì¼ ì—…ë°ì´íŠ¸ê°€ ê°€ëŠ¥í•˜ë©° ì—…ë°ì´íŠ¸ ë²„ì „ ì •ë³´ê°€ ì¶”ê°€ ê¸°ë¡ëœë‹¤.   

`kubectl explain` ëª…ë ¹ì–´ë¥¼ í†µí•´ ë¦¬ì†ŒìŠ¤ë³„ ì‚¬ìš© ê°€ëŠ¥í•œ ë‚´ë¶€ ì†ì„±ì„ ë³¼ ìˆ˜ ìˆë‹¤.  

```
$ kubectl explain pods
KIND:     Pod
VERSION:  v1

DESCRIPTION:
     Pod is a collection of containers that can run on a host. This resource is
     created by clients and scheduled onto hosts.

FIELDS:
   apiVersion	<string>
     APIVersion defines the versioned schema of this representation of an
     ...

$ kubectl explain pods.metadata
KIND:     Pod
VERSION:  v1

RESOURCE: metadata <Object>

DESCRIPTION:
     Standard object's metadata. More info:
     https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#metadata

     ObjectMeta is metadata that all persisted resources must have, which
     includes all objects users must create.

FIELDS:
   annotations	<map[string]string>
     Annotations is an unstructured key value map stored with a resource that
     may be set by external tools to store and retrieve arbitrary metadata. They
     ...
```

ë°ì´í„° íƒ€ì…ê³¼ í•¨ê»˜ íŠ¸ë¦¬í˜•ì‹ìœ¼ë¡œ ì¶œë ¥ ê°€ëŠ¥  

```
$ kubectl explain pods --recursive
...
```

## kind  

> <https://kubernetes.io/ko/docs/concepts/overview/working-with-objects/kubernetes-objects/>

`kind` ì†ì„±ì—ëŠ” ë©”ë‹ˆí˜ìŠ¤íŠ¸ì— ì„¤ì •í•  **ì¿ ë²„ë„¤í‹°ìŠ¤ ë¦¬ì†ŒìŠ¤ ì¢…ë¥˜**ë¥¼ ê¸°ìˆ í•œë‹¤.  

* ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ - `Pod`, `ReplicaSet`, `Deployment`  
* ë„¤íŠ¸ì›Œí¬ ê´€ë¦¬ - `Service`, `Ingress`  
* ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì • ì •ë³´ ê´€ë¦¬ - `ConfigMap`, `Secrets`
* ë°°ì¹˜ì¡ ê´€ë¦¬ - `Job`, `CronJob`  

## metadata.labels

> <https://kubernetes.io/ko/docs/concepts/overview/working-with-objects/labels/>

ì¿ ë²„ì—ì„  ìˆ˜ì›”í•œ ë¦¬ì†ŒìŠ¤ ê´€ë¦¬ ë¥¼ ìœ„í•´ `key-value` í˜•ì‹ì˜  `label` ë¥¼ ì‚¬ìš©í•œë‹¤.  

```yaml
# Label/label-pod.yaml
apiVersion: v1
kind: Pod
metadata:
  name: nginx-pod-a
  labels:
    env: test
    app: photo-view
spec:
  containers:
  - image: nginx
	name: photoview-container
---
apiVersion: v1 # --- ë¥¼ ì‚¬ìš©í•´ í•˜ë‚˜ì˜ íŒŒì¼ì— 2ê°œì˜ ë¦¬ì†ŒìŠ¤ ì •ë³´ ì…ë ¥ ê°€ëŠ¥
kind: Pod
metadata:
  name: nginx-pod-b
  labels:
    env: test
    app: imagetrain
spec:
  containers:
  - image: nginx
    name: photoview-container
```

```
$ kubectl apply -f Label/label-pod.yaml
pod/nginx-pod-a created
pod/nginx-pod-b created

$ kubectl get pod --show-labels
NAME              READY   STATUS    RESTARTS   AGE   LABELS
nginx-pod-a       1/1     Running   0          24s   app=photo-view,env=test
nginx-pod-b       1/1     Running   0          24s   app=imagetrain,env=test
```

ë§¤ë‹ˆí˜ìŠ¤íŠ¸ íŒŒì¼ ë‚´ë¶€ ë¦¬ì†ŒìŠ¤ `label` ì„ ìˆ˜ì •í•´ì„œ ë‹¤ì‹œ `apply`,  
`imagetrain -> predictoin` ìœ¼ë¡œ ìˆ˜ì •

```
$ kubectl apply -f Label/label-pod.yaml
pod/nginx-pod-a unchanged
pod/nginx-pod-b configured

$ kubectl get pod --show-labels
NAME              READY   STATUS    RESTARTS   AGE    LABELS
nginx-pod-a       1/1     Running   0          6m3s   app=photo-view,env=test
nginx-pod-b       1/1     Running   0          6m3s   app=predictoin,env=test
```

`ë¼ë²¨ ì„ íƒ` ì†ì„± `-l` ì‚¬ìš©í•˜ì—¬ ë¼ë²¨ì„ í†µí•´ ìƒì„± ë¦¬ì†ŒìŠ¤ ê²€ìƒ‰ ê°€ëŠ¥  

```
$ kubectl get pod -l app=photo-view,env=test
NAME          READY   STATUS    RESTARTS   AGE
nginx-pod-a   1/1     Running   0          7m13s
```

|ì—°ì‚°ì|ì„¤ëª…|  
|---|---|  
`key=value` | `key` ê°’ì´ `value` ì¼ ê²½ìš°  
`key!=value` | `key` ê°’ì´ `value` ì•„ë‹ ê²½ìš°  
`'key in (...value)'` | `key` ê°’ì´ `value` ì— í¬í•¨ ë ê²½ìš°  
`'key notin (...value)'` | `key` ê°’ì´ `value` ì— í¬í•¨ë˜ì§€ ì•Šì„ ê²½ìš°  
`key` | `key` ê°’ì´ ì¡´ì¬í•  ê²½ìš°  
`!key` | `key` ê°’ì´ ì¡´ì¬í•˜ì§€ ì•Šì„ ê²½ìš°  

> `in`, `notin` ì—°ì‚°ì€ í™€ë”°ì˜´í‘œë¡œ ë¬¶ì–´ì£¼ì–´ì•¼ í•œë‹¤.  
ì½¤ë§ˆë¡œ `AND` ì—°ì‚°ì€ ì‚¬ìš© ê°€ëŠ¥í•˜ì§€ë§Œ `OR` ì—°ì‚°ì€ ì‚¬ìš© ë¶ˆê°€ëŠ¥í•˜ë‹¤.  

ì‚­ì œëª…ë ¹  

```
$ kubectl delete -f Label/label-pod.yaml
pod "nginx-pod-a" deleted
pod "nginx-pod-b" deleted
```

---
title:  "ì¿ ë²„ë„¤í‹°ìŠ¤ - ê°œìš”!"

read_time: false
share: false
author_profile: false
# classes: wide

categories:
  - docker
  - kubernetes

tags: kubernetes

toc: true
toc_sticky: true

---


# ì¿ ë²„ë„¤í‹°ìŠ¤

êµ¬ê¸€ì—ì„œ ìŠ¤íƒ€íŠ¸í•œ ì˜¤í”ˆì†ŒìŠ¤ë¡œ êµ¬ì„±ëœ ì»¨í…Œì´ë„ˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ íˆ´.  

ì»¨í…Œì´ë„ˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ íˆ´ì€ ì¿ ë²„ë„¤í‹°ìŠ¤ ì™¸ì—ë„ Amazone ECS, ë„ì»¤ ìŠ¤ì›œ, ì•„ë§ˆì¹˜ ë…¸ë§ˆë“œ, ì•„íŒŒì¹˜ Mesos ë“±ì´ ìˆë‹¤.  

ì´ì¤‘ì—ì„œ ê°€ì¥ ì¸ê¸°ìˆëŠ” ì»¨í…Œì´ë„ˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ íˆ´ì´ ì¿ ë²„ë„¤í‹°ìŠ¤ì´ë‹¤.  


## minikube ì„¤ì¹˜

ì¿ ë²„ë„¤í‹°ìŠ¤ ì‹¤ìŠµìš©ìœ¼ë¡œ ì‹¤ì œ í´ëŸ¬ìŠ¤í„°ìš© PC ë¥¼ ì—¬ëŸ¬ëŒ€ êµ¬ë§¤í•˜ì—¬ êµ¬ì¶•í•˜ë©´ ì¢‹ê² ì§€ë§Œ   
`minikube` ë¼ëŠ” íˆ´ë¡œë„ ê°€ìƒìœ¼ë¡œ ë¡œì»¬í”¼ì‹œì— í™˜ê²½ êµ¬ì¶•ì´ ê°€ëŠ¥í•˜ë‹¤.  

ê°€ìƒí™˜ê²½ì€ ê¸°ë³¸ì ìœ¼ë¡œ `docker` ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ì„¤ì •í•œë‹¤.  

```
$ brew install minikube
$ minikube start --driver=docker
ğŸ˜„  Darwin 10.15.4 ìœ„ì˜ minikube v1.9.2
...
ğŸ„  ëë‚¬ìŠµë‹ˆë‹¤! ì´ì œ kubectl ì´ "minikube" ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤
$ minikube config set driver docker # docker ë¥¼ ê¸°ë³¸ ê°€ìƒë“œë¼ì´ë²„ë¡œ ì„¤ì •  
```

ì‹¤í–‰ëœ `minikube` ìƒíƒœ ì¡°íšŒ  

```
$ minikube status
m01
host: Running
kubelet: Running
apiserver: Running
kubeconfig: Configured

$ docker ps
CONTAINER ID        IMAGE                                COMMAND                  CREATED             STATUS              PORTS                                                                           NAMES
2f61e951c809        gcr.io/k8s-minikube/kicbase:v0.0.8   "/usr/local/bin/entrâ€¦"   13 minutes ago      Up 10 minutes       127.0.0.1:32773->22/tcp, 127.0.0.1:32772->2376/tcp, 127.0.0.1:32771->8443/tcp   minikube

$ minikube stop
$ minikube start
```

`kubectl` ëª…ë ¹ì„ í†µí•´ ë¡œì»¬ì— ì„¤ì¹˜ëœ í´ëŸ¬ìŠ¤í„°ë¥¼ ì¡°ì‘ ê°€ëŠ¥í•˜ë‹¤.  

```
$ kubectl get node -o=wide
NAME       STATUS   ROLES    AGE     VERSION   INTERNAL-IP   EXTERNAL-IP   OS-IMAGE       KERNEL-VERSION     CONTAINER-RUNTIME
minikube   Ready    master   4m25s   v1.18.0   172.17.0.2    <none>        Ubuntu 19.10   4.19.76-linuxkit   docker://19.3.2
$ kubectl version --output yaml # ë²„ì „ í™•ì¸
```

## docker desktop

mac, window ë“±ì˜ ë„ì»¤ ì„¤ì¹˜ì‹œ docker desktop ìœ¼ë¡œ ì„¤ì¹˜í•˜ë©´ ì¿ ë²„ë„¤í‹°ìŠ¤ë¥¼ ì‰½ê²Œ ì‚¬ìš© ê°€ëŠ¥  

<!-- 
## ì¿ ë²„ë„¤í‹°ìŠ¤ ì„¤ì¹˜ - kubeadm

> https://kubernetes.io/ko/docs/setup/production-environment/tools/

ëŒ€ë¶€ë¶„ì˜ í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤ ì—…ì²´ì—ì„œ ìì²´ ìš´ì˜ í´ëŸ¬ìŠ¤í„°ë¥¼ ì œê³µí•˜ì§€ë§Œ
ë¡œì»¬ PC ì—¬ëŸ¬ëŒ€ë¡œ ì¿ ë²„ë„¤í‹°ìŠ¤ êµ¬ì¶•ì‹œì— ìœ„ì˜ íˆ´ì„ ì‚¬ìš©í•˜ì—¬ ì‰½ê²Œ êµ¬ì¶• ê°€ëŠ¥í•¨.  

> https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/
`kubeadm` - ì¿ ë²„ë„¤í‹°ìŠ¤ ê³µì‹ í´ëŸ¬ìŠ¤í„° ìƒì„±/ê´€ë¦¬ ë„êµ¬  

> https://medium.com/finda-tech/overview-8d169b2a54ff



### ì‚¬ì „ ì„¤ì •  

```
$ sudo modprobe br_netfilter # ì»¤ë„ ëª¨ë“ˆ ì ì¬ - 

$ sudo swapoff -a # ìŠ¤ì™‘ ë¹„í™œì„± 

$ lsmod | grep br_netfilter  # br_netfilter ì»¤ë„ ëª¨ë“ˆì´ ì˜¬ë¼ê°€ìˆëŠ”ì§€ í™•ì¸
br_netfilter           28672  0
bridge                176128  1 br_netfilter

$ cat <<EOF | sudo tee /etc/sysctl.d/k8s.conf
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
EOF

$ sudo sysctl --system
```

> `br_netfilter` - ë¸Œë¦¿ì§€ë¥¼ í†µí•´ ì „ë‹¬ë˜ëŠ” íŒ¨í‚·ì´ `iptables` ì— ì œì–´ë¨, `Pod` ê°„ í†µì‹ ì‹œ í•„ìš”  
> `/etc/sysctl.d/k8s.conf` íŒŒì¼ ì—­ì‹œ ë¸Œë¦¿ì§€ê°„ íŒ¨í‚· í†µì‹ ì„ ìœ„í•œ ì„¤ì •íŒŒì¼  

```
$ curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add -
$ cat <<EOF | sudo tee /etc/apt/sources.list.d/kubernetes.list
deb https://apt.kubernetes.io/ kubernetes-xenial main
EOF
```

> `gpg` ì„¤ì • ë° `apt list` ì¶”ê°€  

```
$ sudo apt-get update && sudo apt-get install -y apt-transport-https curl
$ sudo apt-get install -y kubelet kubeadm kubectl
$ sudo apt-mark hold kubelet kubeadm kubectl
```

> `kubelet` `kubeadm` `kubectl` ì„¤ì¹˜  


```
$ sudo kubeadm init --pod-network-cidr=172.28.0.0/14
```

> ë„¤íŠ¸ì›Œí¬ ëŒ€ì—­ ì„¤ì • 

### kubectl ë“±ë¡  

```
$ mkdir -p $HOME/.kube
$ sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
$ sudo chown $(id -u):$(id -g) $HOME/.kube/config
```

> `kubectl` ì„ í†µí•´ ì»¨íŠ¸ë¡¤ í•˜ê³  ì‹¶ì€ pc ì— ìœ„ ëª…ë ¹ì–´ ì‚½ì… 

```
$ sudo kubeadm token list
TOKEN                     TTL         EXPIRES                     USAGES                   DESCRIPTION                                                EXTRA GROUPS
<TOKEN-VALUE>             23h         2020-10-27T14:07:05+09:00   authentication,signing   The default bootstrap token generated by 'kubeadm init'.   system:bootstrappers:kubeadm:default-node-token
```

> `kube master` ì—ì„œ í† í°ê³¼ `hash` ê°’ í™•ì¸  

```
$ openssl x509 -pubkey -in /etc/kubernetes/pki/ca.crt | openssl rsa -pubin -outform der 2>/dev/null | openssl dgst -sha256 -hex | sed 's/^.* //'
<SHA-256 HASH-VALUE>
```

### ë…¸ë“œ ì¶”ê°€

```
$ sudo swapoff -a
$ sudo kubeadm join 192.168.10.235:6443 --token <TOKEN-VALUE> \
    --discovery-token-ca-cert-hash sha256:<SHA-256 HASH-VALUE>
```
 -->

# ì¿ ë²„ë„¤í‹°ìŠ¤ ì•„í‚¤í…ì²˜

## ë§ˆìŠ¤í„°

ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„° ì „ì²´ë¥¼ ê´€ë¦¬í•˜ëŠ” ì—­í•    
ì—¬ëŸ¬ëŒ€ì˜ í´ëŸ¬ìŠ¤í„° ë…¸ë“œì˜ ë¦¬ì†ŒìŠ¤ ìƒí™© íŒŒì•…, ì»¨í…Œì´ë„ˆë¥¼ ê°€ë™ì‹œí‚¬ ë…¸ë“œë¥¼ ì„ íƒ  

`etcd` ë¼ëŠ” ë¶„ì‚° `Key-value store` ë¥¼ ì‚¬ìš©í•´ í´ëŸ¬ìŠ¤í„° êµ¬ì„±ì •ë³´ë¥¼ ê´€ë¦¬  

> `/etc` + `distribute` í•˜ëŠ” ëœ»ì„ ë‹´ì€ ë‹¨ì–´. ë ˆë“œí—·ì—ì„œ ì„¤ì •íŒŒì¼ì„ ì„œë²„ê°„ ê³µìœ í•˜ê¸° ìœ„í•´ ë§Œë“  íˆ´ì„ ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œ ìŠ¹ê³„í•œê²ƒ.  

## ë…¸ë“œ

> https://kubernetes.io/ko/docs/tutorials/kubernetes-basics/explore/explore-intro/

ì»¨í…Œì´ë„ˆê°€ ì‘ë™ë˜ëŠ” ì„œë²„, ì—¬ëŸ¬ëŒ€ì˜ ë…¸ë“œë¥¼ ì¤€ë¹„í•´ í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì„±,  
ë…¸ë“œëŠ” í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤ íšŒì‚¬ì˜ ê°€ìƒ ë¨¸ì‹  í˜¹ì€ ë¬¼ë¦¬ ë¨¸ì‹ ì´ ë…¸ë“œì—­í• ì„ í•œë‹¤.  

í•´ë‹¹ ë…¸ë“œì•ˆì—ì„œ ì—¬ëŸ¬ëŒ€ì˜ ì»¨í…Œì´ë„ˆ(ì¼ë°˜ì ìœ¼ë¡œ ë„ì»¤)ê°€ ë™ì‘  


# ì¿ ë²„ë„¤í‹°ìŠ¤ ì»´í¬ë„ŒíŠ¸

> https://kubernetes.io/ko/docs/concepts/overview/components/

ë§ˆìŠ¤í„°ì™€ ë…¸ë“œëŠ” ë‚´ë¶€ì—ì„œ ê°ì¢… ë™ì‘ì„ í•˜ëŠ” ì»´í¬ë„ŒíŠ¸(ë…¸ë“œ, ë§ˆìŠ¤í„°)ë“¤ì´ ì¡´ì¬í•œë‹¤.

![kube1](/assets/2020/kube1.png)  


## ë§ˆìŠ¤í„° ì»´í¬ë„ŒíŠ¸

**API Server** - ì¿ ë²„ì˜ ë¦¬ì†ŒìŠ¤ ì •ë³´ë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•œ Rest API ì•¤ë“œí¬ì¸íŠ¸ ì„œë²„,  
ê° ì»´í¬ë„ŒíŠ¸ë¡œë¶€í„° ì •ë³´ë¥¼ ë°›ì•„ `etcd` ì— ì €ì¥, ì»´í¬ë„ŒíŠ¸ê°„ í†µì‹ , ë…¸ë“œê°„ í†µì‹ ì„ ì§€ì›í•œë‹¤.  
ê·¸ë¦¼ì„ ë³´ë©´ ëª¨ë“  ì»´í¬ë„ŒíŠ¸ë“¤ì´ `API Server` ë¥¼ í†µí•´ í†µì‹ í•˜ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆìŒ.  
`kubectl` ëª…ë ¹ ë˜í•œ `API Server` ë¥¼ í†µí•´ ì „íŒŒëœë‹¤.  

**ë°ì´í„° ìŠ¤í† ì–´(etcd)** - í´ëŸ¬ìŠ¤í„°ì˜ êµ¬ì„±ì„ ìœ ì§€í•˜ëŠ” ë¶„ì‚° `key-value store`, ë…¸ë“œì˜ ìƒíƒœì •ë³´, ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œ í•„ìš”í•œ ëª¨ë“  ì„¤ì • ì •ë³´ê°€ ë“¤ì–´ê°€ ìˆìœ¼ë©° `API Server` ê°€ ì´ë¥¼ ì°¸ì¡°í•´ ê° ì»´í¬ë„ŒíŠ¸ê°€ ë™ì‘í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤Œ,  
ì¤‘ìš”í•œ ë°ì´í„°ì´ê¸°ì— ë°±ì—…, ë³„ë„ì˜ ì„œë²„ë“¤ì— ë¶„ì‚°ì‹¤í–‰ í•œë‹¤.  

**ìŠ¤ì¼€ì¤„ëŸ¬** - íŒŒë“œë¥¼ ì–´ëŠ ë…¸ë“œì—ì„œ ì‘ë™ì‹œí‚¬ì§€ë¥¼ ì œì–´í•˜ëŠ” ë°±ì•¤ë“œ ì»´í¬ë„ŒíŠ¸, `API Server` ì™€ í†µì‹ í•˜ë©° í´ëŸ¬ìŠ¤í„° ìƒíƒœë¥¼ í™•ì¸, ë¹ˆê³µê°„ì˜ ë…¸ë“œì— íŒŒë“œë¥¼ í• ë‹¹ ë° ì‹¤í–‰í•˜ëŠ” ìŠ¤ì¼€ì¤„ë§ì„ ì²˜ë¦¬í•œë‹¤.  

**ì»¨íŠ¸ë¡¤ëŸ¬ ë§¤ë‹ˆì €** - íŒŒë“œë¥¼ ê´€ë¦¬í•˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ë“¤ì´ ê³³ê³³ì— ë°°ì¹˜ë˜ì–´ ìˆê³  ì´ ì»¨íŠ¸ë¡¤ëŸ¬ ê°ê°ì„ ì‹¤í–‰í•˜ëŠ” ì»´í¬ë„ŒíŠ¸ê°€ ì»¨íŠ¸ë¡¤ëŸ¬ ë§¤ë‹ˆì €. í´ëŸ¬ìŠ¤í„°ì˜ ìƒíƒœë¥¼ ê°ì‹œ, í•­ìƒ ì •ìƒìƒíƒœë¥¼ ìœ ì§€ì‹œí‚¤ëŠ” ë°±ì•¤ë“œ ì»´í¬ë„ŒíŠ¸



## ë…¸ë“œ ì»´í¬ë„ŒíŠ¸

**kubelet** - ë…¸ë“œ ë‚´ë¶€ì—ì„  `kubelet` ì´ë¼ëŠ” ì—ì´ì „íŠ¸ê°€ ì›€ì§ì´ë©° ì»¨í…Œì´ë„ˆ(íŒŒë“œ)ë¥¼ ì‹¤í–‰, í—¬ìŠ¤ì²´í¬ í•œë‹¤.  
ë…¸ë“œì˜ `status` ë¥¼ ì •ê¸°ì ìœ¼ë¡œ ê°ì‹œí•˜ë©° ì´ë¥¼ `API Server` ë¡œ ì „ì†¡ë˜ê³  `etcd` ì— ì €ì¥ëœë‹¤.    

**kube-proxy** - í´ëŸ¬ìŠ¤í„° ì•ˆì˜ ë³„ë„ì˜ ê°€ìƒ ë„¤íŠ¸ì›Œí¬ ì„¤ì • ê´€ë¦¬í•˜ëŠ”ë° ì´ëŸ° ê°€ìƒ ë„¤íŠ¸ì›Œí¬ ë™ì‘ì„ ê´€ë¦¬í•˜ëŠ” ì»´í¬ë„ŒíŠ¸

## kubectl 

ë§ˆìŠ¤í„° ì»´í¬ë„ŒíŠ¸ ì¤‘ í•˜ë‚˜ì¸ `API Server` ì™€ í†µì‹ í•˜ê¸° ìœ„í•´ `kubectl` ëª…ë ¹ì„ ì‚¬ìš©í•œë‹¤.   
`kubectl` ê³¼ `API Server`ê°€ ì–´ë–»ê²Œ ì—°ê²°ë˜ì–´ ìˆëŠ”ì§€ ì•Œì•„ë³´ì.  

```
$ ls ~/.kube
cache      config     http-cache
```

```yaml
clusters:
- cluster:
    certificate-authority: /Users/gojiyong/.minikube/ca.crt
    server: https://127.0.0.1:32768
  name: minikube 
# kubectl ëª…ë ¹ ì‹¤í–‰ì‹œ ì‚¬ìš©í•  í´ëŸ¬ìŠ¤í„° ì •ë³´

contexts:
- context:
    cluster: minikube
    user: minikube
  name: minikube
current-context: minikube
kind: Config
preferences: {}
# í´ëŸ¬ìŠ¤í„° ì‚¬ìš©ì ì •ë³´ context, 

users:
- name: minikube
  user:
    client-certificate: /Users/gojiyong/.minikube/profiles/minikube/client.crt
	client-key: /Users/gojiyong/.minikube/profiles/minikube/client.key
# ì—‘ì„¸ìŠ¤ í•˜ëŠ” ì‚¬ìš©ì ì •ë³´ - í´ëŸ¬ìŠ¤í„° ì—‘ì„¸ìŠ¤ë¥¼ ìœ„í•œ ì¸ì¦ í‚¤ ë“± ì„¤ì •  
```


# ì¿ ë²„ë„¤í‹°ìŠ¤ ë¦¬ì†ŒìŠ¤

## íŒŒë“œ(Pod)

> https://kubernetes.io/ko/docs/concepts/workloads/pods/

ì¿ ë²„ì—ì„  ì—¬ëŸ¬ê°œì˜ ì»¨í…Œì´ë„ˆë¥¼ ëª¨ì•„ íŒŒë“œë¡œ ê´€ë¦¬í•œë‹¤.  

![kube2](/assets/2020/kube2.png){: .shadow}{: width="400"} 

íŒŒë“œ ë‚´ë¶€ì—ì„œ ì›¹ì„œë²„ìš©, íŒŒì¼ì„œë²„ìš©, í”„ë¡ì‹œ ì„œë²„ìš© ë„ì»¤ ì»¨í…Œì´ë„ˆ ì—¬ëŸ¬ê°œë¥¼ ëª¨ì•„ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤.  
ì¿ ë²„ì—ì„  ì´ íŒŒë“œê°€ ì•± ë””í”Œë¡œì´ ë‹¨ìœ„ê°€ ë˜ë©° íŒŒë“œ ë‹¨ìœ„ë¡œ ì»¨í…Œì´ë„ˆ ì‘ì„±, ì‹œì‘, ì •ì§€, ì‚­ì œ ë“±ì˜ ì¡°ì‘ì„ ì§„í–‰í•œë‹¤.  

íŒŒë“œëŠ” í•­ìƒ í•˜ë‚˜ì˜ ë…¸ë“œì— ë°°ì¹˜ë˜ë©° íŒŒë“œê°€ ìª¼ê°œì§ˆ ìˆœ ì—†ë‹¤.  

ë”°ë¼ì„œ íŒŒë“œ ë‚´ë¶€ì—ì„œ ê°€ìƒ ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ ì¹´ë“œ(**ì‚¬ì„¤IP**)ë¥¼ ê° ì»¨í…Œì´ë„ˆì—ê²Œ ë°œê¸‰í•˜ë©° ì„œë¡œ ê°™ì€ ë„¤íŠ¸ì›Œí¬ ì•ˆì— ìˆìŒìœ¼ë¡œ `localhost` ë¥¼ í†µí•´ í†µì‹  ê°€ëŠ¥í•˜ë‹¤.  



## ë¦¬í”Œë¦¬ì¹´ ì…‹(Replica Set)

> https://kubernetes.io/ko/docs/concepts/workloads/controllers/replicaset/

í´ëŸ¬ìŠ¤í„° ì•ˆì— ì§€ì •ëœ ìˆ˜ì˜ íŒŒë“œë¥¼ ì¼ì •í•˜ê²Œ ìœ ì§€í•˜ë©° ì¥ì• ëŒ€ì‘ ë° ìë™ ì‹¤í–‰í•˜ëŠ” ì—­í• .  
í´ëŸ¬ìŠ¤í„° ì•ˆì—ì„œ ê°€ë™ë˜ëŠ” íŒŒë“œ ìˆ˜ë¥¼ **ë¦¬í”Œë¦¬ì¹´ ìˆ˜** ë¼ í•œë‹¤.  

## ë””í”Œë¡œì´ë¨¼íŠ¸(Deployment)

> https://kubernetes.io/ko/docs/concepts/workloads/controllers/deployment/

ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬ ë²„ì „ ë‹¨ìœ„ë¥¼ ê´€ë¦¬í•˜ëŠ” ë¦¬ì†ŒìŠ¤.  

íŒŒë“œì•ˆì˜ ì»¨í…Œì´ë„ˆë¥¼ ë²„ì „ì—… í•˜ê³  ì‹¶ì„ ë•Œ ì‹œìŠ¤í…œì„ ì •ì§€ì‹œí‚¤ì§€ ì•Šê³  ë²„ì „ì—…(ë¡¤ë§ì—…ë°ì´íŠ¸), ë¡¤ë°± ê°€ëŠ¥

## ë°ëª¬ ì…‹(Daemon Set)

> https://kubernetes.io/ko/docs/concepts/workloads/controllers/daemonset/

ìŠ¤ì¼€ì¤„ëŸ¬ê°€ ì–´ë–¤ ë…¸ë“œì—ì„œ ë™ì‘í• ì§€ëŠ” ë§ˆìŠ¤í„° ë…¸ë“œì—ì„œ ìë™ìœ¼ë¡œ ê²°ì •ëœë‹¤.  

í•˜ì§€ë§Œ íŠ¹ì • íŒŒë“œ(ë¡œê·¸ì½œë ‰í„°, ê°ì‹œì—ì´ì „íŠ¸ ë“±)ëŠ” í´ëŸ¬ìŠ¤í„°ì—ì„œ ë°˜ë“œì‹œ í•˜ë‚˜ì”© ì‘ë™ì‹œí‚¤ê³  ì‹¶ì€ ê²½ìš°ê°€ ìˆëŠ”ë° ì´ë•Œ ë°ëª¬ì…‹ì„ ì‚¬ìš©í•œë‹¤.  

ë¦¬í”Œë¦¬ì¹´ ì…‹ê³¼ ë¹„êµí•´ ì¢€ë” ì—„ê²©í•˜ê²Œ ê´€ë¦¬í•˜ê³  ì‹¶ë‹¤ë©´ ë°ëª¬ì…‹ì„ ì‚¬ìš©  
ë¦¬í”Œë¦¬ì¹´ ì…‹ê³¼ ë‹¤ë¥´ê²Œ ì‹¤í–‰ì¤‘ì¸ íŒŒë“œ ìˆ˜ ë¥¼ ê²°ì •í•  ìˆ˜ ë„ ì—†ë‹¤.  

> kube-proxy ë˜í•œ ë°ëª¬ ì…‹ì„ ì‚¬ìš©í•´ ê°€ë™ëœë‹¤.  

## ìŠ¤í…Œì´íŠ¸í’€ ì…‹(Stateful Set)

> https://kubernetes.io/ko/docs/concepts/workloads/controllers/statefulset/


ì»¨í…Œì´ë„ˆëŠ” stateless ë¡œ ì‹¤í–‰ëœë‹¤, ì–´ë–¤ ë…¸ë“œì—ì„œ ì–´ë–¤ IP ë¥¼ ê°€ì§€ê³  ì‹¤í–‰ë ì§€ ëª¨ë¥¸ë‹¤ëŠ” ëœ»ì´ë‹¤.  

ë°ì´í„° ë² ì´ìŠ¤ì™€ ê°™ì€ ê³ ì •ëœ ìƒíƒœ(Stateful) ì„ í•„ìšœë¡œ í•  ê²½ìš°ë„ ìˆëŠ”ë° ì´ë•Œ **ìŠ¤í…Œì´íŠ¸í’€ ì…‹** ë¥¼ ì‚¬ìš©í•œë‹¤.

ì•ˆì •ëœ, ê³ ì •ëœ, ì§€ì†ì„±ì„ ë³´ì¦í•œë‹¤.  

# ì¿ ë²„ë„¤í‹°ìŠ¤ ë„¤íŠ¸ì›Œí¬ ê´€ë¦¬

í´ëŸ¬ìŠ¤í„° ì•ˆì˜ íŒŒë“œì— ëŒ€í•´ í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì—ì„œ, ì™¸ë¶€ì—ì„œ ì—‘ì„¸ìŠ¤ í•˜ê¸° ìœ„í•œ ë¦¬ì†ŒìŠ¤ê°€ `Service`, `Ingress` ì´ë‹¤.

> Ingress: ì…ì¥ê¶Œ

## Service

> https://kubernetes.io/ko/docs/concepts/services-networking/service/

í´ëŸ¬ìŠ¤í„° ì•ˆì—ì„œ ì‹¤í–‰ëœ íŒŒë“œì— ëŒ€í•´ ì—‘ì„¸ìŠ¤ í•  ë•Œ `Service` ë¥¼ ì •ì˜í•œë‹¤.  
`Service` ì— ì˜í•´ í• ë‹¹ë˜ëŠ” IP ì£¼ì†Œì—ëŠ” `Cluster IP` `External IP` ê°€ ìˆë‹¤.  

`Cluster IP` - í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì—ì„œ íŒŒë“œë¼ë¦¬ í†µì‹ í•˜ê¸° ìœˆí•œ IP 
`External IP` - ì™¸ë¶€ì— ê³µê°œí•˜ëŠ” IP

í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ íŒŒë“œê°„ì—ëŠ” ë…¸ë“œìƒì˜ Proxy ë°ëª¬ì´ ì†¡ìˆ˜ì‹  ì²˜ë¦¬ë¥¼ í•´ì¤€ë‹¤.  

## Ingress 

> https://kubernetes.io/ko/docs/concepts/services-networking/ingress/

í´ëŸ¬ìŠ¤í„° ë‚´ì˜ ì„œë¹„ìŠ¤ì— ëŒ€í•œ ì™¸ë¶€ ì ‘ê·¼ì„ ê´€ë¦¬í•˜ëŠ” API ì˜¤ë¸Œì íŠ¸, ì¼ë°˜ì ìœ¼ë¡œ HTTPë¥¼ ê´€ë¦¬í•œë‹¤.  

# ì–´í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì •ì •ë³´ ê´€ë¦¬

## Config Map

ì»¨í…Œì´ë„ˆì— í• ë‹¹ë  ì–´í”Œë¦¬ì¼€ì´ì…˜ì˜ ì„¤ì •ì •ë³´, êµ¬ì„±íŒŒì¼, ëª…ë ¹ì¸ìˆ˜, í¬íŠ¸ë²ˆí˜¸, ê³ ìœ ì‹ë³„ ë²ˆí˜¸ ë“±ì„ íŒŒë“œì—ì„œ ì°¸ì¡°í•  ìˆ˜ ìˆë„ë¡ í•´ì£¼ëŠ” ë°ì´í„°, `Key-Value` í˜•ì‹ì˜ íŒŒì¼í˜•íƒœì˜ ë°ì´í„°.  

ë³¼ë¥¨ ë§ˆìš´íŠ¸ë¥¼ í†µí•´ ê° ì»¨í…Œì´ë„ˆì—ì„œ ê³µí†µ ì„¤ì •ì €ë³´ë¡œ ì‚¬ìš©ë  ìˆ˜ ìˆë‹¤.  

## Secrets

ì»¨í”¼ê·¸ ë§µê³¼ ê°™ì´ êµ¬ì„±ì •ë³´ë¥¼ ì–´í”Œë¦¬ì¼€ì´ì…˜ì— ì „ë‹¬í•˜ê¸° ìœ„í•œ ë°ì´í„°, `DB password`, `OAuth` í† í°ê³¼ ê°™ì€ ë¹„ë°€ ì •ë³´ë¥¼ ì£¼ë¡œ ê´€ë¦¬í•œë‹¤.  

ì•”í˜¸í™” ë˜ì–´ `etcd` ì—ì„œ ê´€ë¦¬ë¨.  

# ë°°ì¹˜ ì¡ ê´€ë¦¬

ì›¹, DB ì„œë²„ì™€ ê°™ì€ ìƒì£¼ ì„œë¹„ìŠ¤ëŠ” íŒŒë“œë¥¼ í†µí•´ í•­ì‹œ ê´€ë¦¬ë˜ì§€ë§Œ  
ê¸°ê³„í•™ìŠµ, ë°°ì¹˜ì²˜ë¦¬ëŠ” `Job`, `CronJob` ì„ í†µí•´ ì‹¤í–‰ë˜ê³  ì •ì§€(ì‹¤í–‰ì™„ë£Œ)ëœë‹¤.  

## Job

`Job`ì€ í•˜ë‚˜ ì´ìƒì˜ íŒŒë“œì—ì„œ ë°°ì¹˜ì²˜ë¦¬ë¥¼ í•˜ê¸° ìœ„í•œ ë¦¬ì†ŒìŠ¤.  
DB ë§ˆì´í¬ë ˆì´ì…˜ê°™ì€ í•œë²ˆì˜ ì‹¤í–‰ìœ¼ë¡œ ëë‚˜ëŠ” ê²ƒì— ì´ìš©ëœë‹¤.  

`Job` ì˜ ì‹¤í–‰ ì˜¤ë¥˜, ì˜ˆì™¸ ë°œìƒì‹œ `Job` ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì„±ê³µí•  ë•Œê¹Œì§€ íŒŒë“œë¥¼ ìƒˆë¡œ ìƒì„±í•´ ì‹¤í–‰ì‹œí‚¨ë‹¤.

## CronJob

`CronJob` ì€ ì •í•´ì§„ ì‹œê°„ì— `Job` ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•œ ë¦¬ì†ŒìŠ¤.  
ë°±ì—…, ë©”ì¼ ì†¡ì‹  ë“±ê³¼ ê°™ì€ ë°°ì¹˜ì²˜ë¦¬ì— ì‚¬ìš©ëœë‹¤.  


# ë„¤ì„ìŠ¤í˜ì´ìŠ¤

ë„¤ì„ìŠ¤í˜ì´ìŠ¤ëŠ” í•˜ë‚˜ì˜ í´ëŸ¬ìŠ¤í„°ë¥¼ ì—¬ëŸ¬ê°œì˜ ë…¼ë¦¬ì  ë‹¨ìœ„ë¡œ ë‚˜ëˆ  ì‚¬ìš©í•˜ê¸° ìœˆí•œ ê¸°ëŠ¥ìœ¼ë¡œ 

> https://kubernetes.io/ko/docs/concepts/overview/working-with-objects/namespaces/

`Pod` ë¥¼ í¬í•¨í•œ ê°ì¢… ì¿ ë²„ë„¤í‹°ìŠ¤ ë¦¬ì†ŒìŠ¤ë¥¼ ê·¸ë£¹í™”, ë‹¤ë¥¸ ê·¸ë£¹ë¼ë¦¬ëŠ” ë¶„ë¦¬í™” í•˜ëŠ” ê¸°ëŠ¥ì„ ì§€ì›í•œë‹¤.  

ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë§Œ ë‹¤ë¥´ë©´ ë™ì¼í•œ ë¦¬ì†ŒìŠ¤ ë„¤ì„ì„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.   
> ë‹¨ ë…¸ë“œëŠ” ë™ì¼í•œ ë¦¬ì†ŒìŠ¤ëª… ì‚¬ìš© ë¶ˆê°€ëŠ¥  

```
$ kubectl get namespace
NAME              STATUS   AGE
default           Active   6d4h 
kube-public       Active   6d4h 
kube-system       Active   6d4h 
kube-node-lease   Active   6d4h 
```

* `default`: ê¸°ë³¸ ê³µê°„  
* `kube-public`: í´ëŸ¬ìŠ¤í„°ì˜ ê³µìš© ê³µê°„, `ConfigMap` ê°™ì€ ë°ì´í„°ê°€ ì €ì¥ë˜ë©° ë¦¬ì†ŒìŠ¤ ëª¨ë‹ˆí„°ë§ìš©ìœ¼ë¡œ ìì£¼ ì‚¬ìš©ëœë‹¤.  
* `kube-system`: ê´€ë¦¬ìš© íŒŒë“œ, ì„¤ì •ì´ ì €ì¥ë˜ëŠ” ê³µê°„
* `kube-node-lease`: ì„ëŒ€ ì˜¤ë¸Œì íŠ¸ìš© ê³µê°„  

`kube-system` ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë‚´ë¶€ì—ì„œ ëŒì•„ê°€ëŠ” `pod` ëª©ë¡ í™•ì¸  

```
$ kubectl get pods --all-namespaces
NAMESPACE     NAME                                     READY   STATUS    RESTARTS   AGE
default       nginx-app-d6ff45774-nlvc8                1/1     Running   0          85m
default       nginx-app-d6ff45774-xwb82                1/1     Running   0          85m
kube-system   coredns-f9fd979d6-27z5q                  1/1     Running   0          177m
kube-system   coredns-f9fd979d6-z78k8                  1/1     Running   0          177m
kube-system   etcd-docker-desktop                      1/1     Running   0          176m
kube-system   kube-apiserver-docker-desktop            1/1     Running   0          176m
kube-system   kube-controller-manager-docker-desktop   1/1     Running   0          176m
kube-system   kube-proxy-g52r7                         1/1     Running   0          177m
kube-system   kube-scheduler-docker-desktop            1/1     Running   2          176m
kube-system   storage-provisioner                      1/1     Running   2          176m
kube-system   vpnkit-controller                        1/1     Running   0          176m
```

ë§ì€ ì¢…ë¥˜ì˜ íŒŒë“œê°€ `kube-system` ì— ì„¤ì •ë˜ì–´ ë™ì‘í•˜ê³  ìˆê³  ìƒˆë¡œë§Œë“  nginx ì˜ ê²½ìš° ê¸°ë³¸ ê³µê°„ì¸ default ë¥¼ ì‚¬ìš©í•œë‹¤.  
ì§€ê¸ˆê¹Œì§€ ë³„ë„ì˜ `namespace` ë¥¼ ì§€ì •í•´ì„œ `pod` ë¥¼ ìƒì„±í•œì ì´ ì—†ê¸°ë•Œë¬¸ì— ëª¨ë‘ `default` ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— í¬í•¨ë˜ì–´ ìˆì„ê²ƒ.  

## ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ìƒì„±  

```yaml
# 
apiVersion: v1
kind: Namespace
metadata:
  name: trade-system
```

`kind: Namespace` ë¥¼ ì‚¬ìš©í•´ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ìƒì„±  

```
$ kubectl create -f Namespace/namespace.yaml
namespace/trade-system created

$ kubectl get namespaces
NAME              STATUS   AGE
default           Active   6d4h
kube-node-lease   Active   6d4h
kube-public       Active   6d4h
kube-system       Active   6d4h
trade-system      Active   8s
```

ì„ í˜¸í•˜ëŠ” ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ì§€ì†ì ìœ¼ë¡œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ì»¨í…ìŠ¤íŠ¸ë¥¼ ìƒì„±í•˜ê³  í•´ë‹¹ ì„¤ì •ì„ ì €ì¥.  

```
$ kubectl config set-context my-context --namespace=trade-system
Context "my-context" created.

$ kubectl config get-contexts
CURRENT   NAME         CLUSTER    AUTHINFO   NAMESPACE
*         minikube     minikube   minikube
          my-context                         trade-system

$ kubectl config use-context my-context # ì»¨í…ìŠ¤íŠ¸ ë³€ê²½ ê°€ëŠ¥    
Switched to context "my-context".
```

ì‚­ì œëª…ë ¹  

```
$ kubectl delete -f Namespace/namespace.yaml
namespace "trade-system" deleted
```


<!-- 
### ACR ë¦¬ì†ŒìŠ¤ ê·¸ë£¹ ìƒì„± 

Azure Container Registry(ACR) - ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ ì €ì¥, ê´€ë¦¬ ë ˆì§€ìŠ¤íŠ¸ë¦¬

```
$ ACR_NAME=sampleBeylessACR
$ ACR_RES_GROUP=$ACR_NAME
$ az group create --resource-group $ACR_RES_GROUP --location koreacentral
```

### ACR ë ˆì§€ìŠ¤íŠ¸ë¦¬ ìƒì„±  

```
$ az acr create --resource-group $ACR_RES_GROUP --name $ACR_NAME --sku Standard --location koreacentral
```

> sku : Stock Keeping Unit(ë‹¤ì¤‘ ì„œë¹„ìŠ¤ ê³„ì¸µ), ACR ìƒì„±ì„ ìœ„í•œ ê°€ê²© ì •ì±…  Standard ë¡œ ì„¤ì •,

### ì´ë¯¸ì§€ ë¹Œë“œ

```
$ az acr build --registry $ACR_NAME --image photo-view:v1.0 v1.0
$ az acr build --registry $ACR_NAME --image photo-view:v2.0 v2.0
```

ìƒ˜í”Œ ì½”ë“œë¥¼ ACRì— ì—…ë¡œë“œ í›„ ë¹Œë“œ(docker build),  

### ìƒì„±ëœ ì´ë¯¸ì§€ í™•ì¸  
```
$ az acr repository show-tags -n $ACR_NAME --repository photo-view
[
  "v1.0",
  "v2.0"
]
```

## `ACR` - `AKS` ì—°ê²°

`Azure Kubernetes Service(AKS)` - ì¿ ë²„ë„¤í‹°ìŠ¤ ë§¤ë‹ˆì§€ë“œ ì„œë¹„ìŠ¤, í´ëŸ¬ìŠ¤í„° ìƒì„±, ìš´ìš© ê´€ë¦¬ê°€ëŠ¥ 

`AKS` ì— í´ëŸ¬ìŠ¤í„°ë¥¼ ìƒì„±í•˜ê³  `ACR` ì— ìƒì„±í•œ ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•´ ì»¨í…Œì´ë„ˆ ìƒì„±í•´ë³´ì.  


### Service Principle ìƒì„±


`AKS` ë¡œ ë§Œë“  í´ëŸ¬ìŠ¤í„°ê°€ `ACR`ì˜ ì´ë¯¸ì§€ì— ì ‘ê·¼í•˜ë ¤ë©´ ê¶Œí•œì„ ë¶€ì—¬í•  í•„ìš”ê°€ ìˆë‹¤.  
`AKS` ì— `Service Principle` ì„ ì„¤ì •í•´ë³´ì.  

ë¨¼ì € `Service Principle` ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•´ `az ad sp create-for-rbac` ëª…ë ¹ì„ ìˆ˜í–‰í•˜ê³  ê²°ê³¼ê°’ì¸ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì–»ì–´ì•¼ í•œë‹¤.  

> RBAC: Rule base access control(ì—­í•  ê¸°ë°˜ ì•¡ì„¸ìŠ¤ ì œì–´)

ACR ì„ ê¸°ë°˜ìœ¼ë¡œ 
```
$ ACR_ID=$(az acr show --name $ACR_NAME --query id --output tsv)
$ SP_NAME=beyless-acr-service-principle
$ SP_PASSWD=$(az ad sp create-for-rbac --name $SP_NAME --role Reader --scopes $ACR_ID --query password --output tsv)
$ APP_ID=$(az ad sp show --id http://$SP_NAME --query appId --output tsv)
```

```
$ echo $ACR_ID
/subscriptions/.../resourceGroups/sampleBeylessACR/providers/Microsoft.ContainerRegistry/registries/sampleBeylessACR
$ echo $APP_ID
4b2a7370-...-...-...-...66
$ echo $SP_PASSWD
bf0f4a65-...-...-...-...09
```

`Service Principle` ìƒì„±ë 

### AKS í´ëŸ¬ìŠ¤í„° ìƒì„±

ë¨¼ì € í´ëŸ¬ìŠ¤í„°ê°€ í¬í•¨ë  ë¦¬ì†ŒìŠ¤ ê·¸ë£¹ ìƒì„±  

```
$ AKS_CLUSTER_NAME=AKSBeylessCluster
$ AKS_RES_GROUP=$AKS_CLUSTER_NAME
$ az group create --resource-group $AKS_RES_GROUP --location japanwest
```

ë¨¼ì € `koreacentral` ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ ì¿ ë²„ë„¤í‹°ìŠ¤ ë²„ì „ í™•ì¸  

```
$ az aks get-versions --location koreacentral --output table
KubernetesVersion    Upgrades
-------------------  ----------------------------------------
1.17.3(preview)      None available
1.16.7               1.17.3(preview)
1.15.10              1.16.7
1.15.7               1.15.10, 1.16.7
1.14.8               1.15.7, 1.15.10
1.14.7               1.14.8, 1.15.7, 1.15.10
```

ì•ˆíƒ€ê°‘ê²Œë„ í•œêµ­ ë‚´ë¶€ì—ì„  ë¬´ë£Œë²„ì „ì„ ì§€ì›í•˜ëŠ” `Standard_D1_v2` ë²„ì „ì˜ AKS ë¥¼ ìƒì„±í•  ìˆ˜ ì—†ë‹¤.  
`location` ì„ `japanwest` ë¡œ ì„¤ì •í•´ ìƒì„± (2020-03-19)
```
$ az aks create \
 --resource-group $AKS_RES_GROUP \
 --name $AKS_CLUSTER_NAME \
 --location japanwest
 --node-count 1 \
 --kubernetes-version 1.13.11 \
 --node-vm-size Standard_D1_v2 \
 --generate-ssh-keys \
 --service-principal $APP_ID \
 --client-secret $SP_PASSWD

$ az aks get-credentials --admin --resource-group $AKS_RES_GROUP --name $AKS_CLUSTER_NAME
```

> ì´ìƒí•˜ê²Œë„ `unauthorized_client` ë¼ëŠ” ì—ëŸ¬ì™€ í•¨ê»˜ ì•ˆë ë•Œ ê°€ ìˆëŠ”ë° ì°¾ì•„ë³´ë‹ˆ ì—¬ëŸ¬ë²ˆ ì‹œë„í•˜ë©´ ëœë‹¤ê³  í•œë‹¤...  
> ì•„ë§ˆ azure ì—ì„œ `Service Principle` ìƒì„± ë° ì‚¬ìš©ì— ì‹œê°„ì´ ì¢€ ê±¸ë¦¬ëŠ” ë“¯ í•˜ë‹¤.   
> ê·¸ë˜ë„ ì•ˆëœë‹¤ë©´ ì•„ë˜ ëª…ë ¹ì„ í†µí•´ `Service Principle` ì„ ì‚­ì œí•˜ê³  ìœ„ ê³¼ì •ì„ ë‹¤ì‹œ ì‹œì‘í•´ë³´ì.    
> `$ az ad sp list --display-name AKSBeylessCluster --query '[].objectId'`  
> `$ az ad sp delete --id ...`  


## kubectl

```
$ kubectl cluster-info
Kubernetes master is running at https://aksbeyless-aksbeylesscluste-10d7f6-d25fab61.hcp.japanwest.azmk8s.io:443
CoreDNS is running at https://aksbeyless-aksbeylesscluste-10d7f6-d25fab61.hcp.japanwest.azmk8s.io:443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy
kubernetes-dashboard is running at https://aksbeyless-aksbeylesscluste-10d7f6-d25fab61.hcp.japanwest.azmk8s.io:443/api/v1/namespaces/kube-system/services/kubernetes-dashboard/proxy
Metrics-server is running at https://aksbeyless-aksbeylesscluste-10d7f6-d25fab61.hcp.japanwest.azmk8s.io:443/api/v1/namespaces/kube-system/services/https:metrics-server:/proxy
```

```
$ kubectl get node -o=wide
NAME                                STATUS   ROLES   AGE   VERSION    INTERNAL-IP   EXTERNAL-IP   OS-IMAGE             KERNEL-VERSION      CONTAINER-RUNTIME
aks-nodepool1-14952662-vmss000000   Ready    agent   25d   v1.13.11   10.240.0.4    <none>        Ubuntu 16.04.6 LTS   4.15.0-1071-azure   docker://3.0.10+azure
```

```
$ kubectl get node -o=jsonpath='{.items[0].metadata.name}'
aks-nodepool1-14952662-vmss000000
```

 -->

# ì• ë“œì˜¨

í´ëŸ¬ìŠ¤í„° ì•ˆì—ì„œ í•„ìš”í•œ ê¸°ëŠ¥ë“¤ (ê°€ìƒ ë„¤íŠ¸ì›Œí¬, DNS ì„œë²„, ëŒ€ì‹œë³´ë“œ, ëª¨ë‹ˆí„°ë§, ë¡œê¹…) ì„ ê¸°ë³¸ì ìœ¼ë¡œ í˜¹ì€ ë³„ë„ë¡œ ì œê³µí•œë‹¤.  


# ë§¤ë‹ˆí˜ìŠ¤íŠ¸ íŒŒì¼(Manifest file, í…œí”Œë¦¿)

> Manifest: ì„ ì–¸ì„œ

í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì—ì„œ ì›€ì§ì´ëŠ” ì»¨í…Œì´ë„ˆ, ë„¤íŠ¸ì›Œí¬, ì¡ ë“±ì˜ ì¿ ë²„ë„¤í‹°ìŠ¤ ë¦¬ì†ŒìŠ¤ë¥¼ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ íŒŒì¼ì„ í†µí•´ ê´€ë¦¬í•œë‹¤.   
`yaml`, `json` í˜•ì‹ì˜ íŒŒì¼ë¡œ êµ¬ì„±ëœë‹¤.   

```yaml
# webserver.yaml
apiVersion: apps/v1 # api ë²„ì „ ì •ë³´ - í˜¸ì¶œí•  api ë²„ì „ ì§€ì •, kubectl api-versions ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë²„ì „ í™•ì¸ ê°€ëŠ¥.
kind: ReplicaSet # ì¿ ë²„ ë¦¬ì†ŒìŠ¤ ì¢…ë¥˜ - Pod, ReplicaSet, Service, ConfigMap, Job ë“±ë“±
metadata: # í•´ë‹¹ ì˜¤ë¸Œì íŠ¸ ì´ë¦„, ë ˆì´ë¸” ì§€ì •
  name: webserver # ë¦¬ì†ŒìŠ¤ ì´ë¦„ - kubectl ëª…ë ¹ìœ¼ë¡œ ì¡°ì‘í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ì´ë¦„
spec: # ë¦¬ì†ŒìŠ¤ì˜ ìƒì„¸ ì •ë³´, ì‹¤í–‰ ë™ì‘ ë°©ì‹ ë“±ì„ ì§€ì •, ì•„ë˜ëŠ” kind = ReplicaSet ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ ì†ì„±ë“¤  
  replicas: 10
  selector:
    matchLabels:
      app: webfront
  template:
    metadata:
      labels:
        app: webfront
    spec:
      containers:
      - image: nginx
        name: webfront-container
        ports:
          - containerPort: 80
```

ë§¤ë‹ˆí˜ìŠ¤íŠ¸ íŒŒì¼ì„ ì‚¬ìš©í•´ ì¿ ë²„ë„¤í‹°ìŠ¤ ë¦¬ì†ŒìŠ¤ ìƒì„±, ì‚­ì œê°€ëŠ¥  

```
$ kubectl apply -f webserver.yaml
replicaset.apps/webserver created

$ kubectl delete -f webserver.yaml
replicaset.apps "webserver" deleted
```

ë§¤ë‹ˆí˜ìŠ¤íŠ¸ íŒŒì¼ì˜ ì •ë³´ëŠ” `etcd` ì— ì €ì¥ë˜ê³  ê´€ë¦¬í•œë‹¤.  
`kuberctl` ëª…ë ¹ìœ¼ë¡œ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ íŒŒì¼ ì—…ë°ì´íŠ¸ê°€ ê°€ëŠ¥í•˜ë©° ì—…ë°ì´íŠ¸ ë²„ì „ ì •ë³´ê°€ ì¶”ê°€ ê¸°ë¡ëœë‹¤.   

`kubectl explain` ì„ í†µí•´ ê° `kind` ë³„ ë‚´ë¶€ ì†ì„±ì„ ë³¼ ìˆ˜ ìˆìŒ  

```
$ kubectl explain pods
KIND:     Pod
VERSION:  v1

DESCRIPTION:
     Pod is a collection of containers that can run on a host. This resource is
     created by clients and scheduled onto hosts.

FIELDS:
   apiVersion	<string>
     APIVersion defines the versioned schema of this representation of an
     ...

$ kubectl explain pods.metadata
KIND:     Pod
VERSION:  v1

RESOURCE: metadata <Object>

DESCRIPTION:
     Standard object's metadata. More info:
     https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#metadata

     ObjectMeta is metadata that all persisted resources must have, which
     includes all objects users must create.

FIELDS:
   annotations	<map[string]string>
     Annotations is an unstructured key value map stored with a resource that
     may be set by external tools to store and retrieve arbitrary metadata. They
     ...
```

ë°ì´í„° íƒ€ì…ê³¼ í•¨ê»˜ íŠ¸ë¦¬í˜•ì‹ìœ¼ë¡œ ì¶œë ¥ ê°€ëŠ¥  

```
$ kubectl explain pods --recursive
...
```

## kind  

> https://kubernetes.io/ko/docs/concepts/overview/working-with-objects/kubernetes-objects/

`kind` ì†ì„±ì—ëŠ” ë©”ë‹ˆí˜ìŠ¤íŠ¸ì— ì„¤ì •í•  ì¿ ë²„ë„¤í‹°ìŠ¤ ë¦¬ì†ŒìŠ¤ ì¢…ë¥˜ë¥¼ ê¸°ìˆ í•œë‹¤.  

* ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì‹¤í–‰ - `Pod`, `ReplicaSet`, `Deployment`  
* ë„¤íŠ¸ì›Œí¬ì˜ ê´€ë¦¬ - `Service`, `Ingress`  
* ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì • ì •ë³´ì˜ ê´€ë¦¬ - `ConfigMap`, `Secrets`
* ë°°ì¹˜ì¡ì˜ ê´€ë¦¬ - `Job`, `CronJob`  


## metadata.labels

> https://kubernetes.io/ko/docs/concepts/overview/working-with-objects/labels/

ì¿ ë²„ì—ì„  ìˆ˜ì›”í•œ ë¦¬ì†ŒìŠ¤ ê´€ë¦¬ ë¥¼ ìœ„í•´ `key-value` í˜•ì‹ì˜  `label` ë¥¼ ì‚¬ìš©í•œë‹¤.  

```yaml
# Label/label-pod.yaml
apiVersion: v1
kind: Pod
metadata:
  name: nginx-pod-a
  labels:
    env: test
    app: photo-view
spec:
  containers:
  - image: nginx
	name: photoview-container
---
apiVersion: v1 # - ë¥¼ ì‚¬ìš©í•´ í•˜ë‚˜ì˜ íŒŒì¼ì— 2ê°œì˜ ë¦¬ì†ŒìŠ¤ ì •ë³´ ì…ë ¥ ê°€ëŠ¥
kind: Pod
metadata:
  name: nginx-pod-b
  labels:
    env: test
    app: imagetrain
spec:
  containers:
  - image: nginx
    name: photoview-container
```

```
$ kubectl apply -f Label/label-pod.yaml
pod/nginx-pod-a created
pod/nginx-pod-b created

$ kubectl get pod --show-labels
NAME              READY   STATUS    RESTARTS   AGE   LABELS
nginx-pod-a       1/1     Running   0          24s   app=photo-view,env=test
nginx-pod-b       1/1     Running   0          24s   app=imagetrain,env=test
```

ë§¤ë‹ˆí˜ìŠ¤íŠ¸ íŒŒì¼ ë‚´ë¶€ ë¦¬ì†ŒìŠ¤ `label` ì„ ìˆ˜ì •í•´ì„œ ë‹¤ì‹œ `apply`,  
`imagetrain -> predictoin` ìœ¼ë¡œ ìˆ˜ì •

```
$ kubectl apply -f Label/label-pod.yaml
pod/nginx-pod-a unchanged
pod/nginx-pod-b configured

$ kubectl get pod --show-labels
NAME              READY   STATUS    RESTARTS   AGE    LABELS
nginx-pod-a       1/1     Running   0          6m3s   app=photo-view,env=test
nginx-pod-b       1/1     Running   0          6m3s   app=predictoin,env=test
```

`Label Selector` ì†ì„± `-l` ì‚¬ìš©í•˜ì—¬ ë¼ë²¨ì„ í†µí•´ ìƒì„± ë¦¬ì†ŒìŠ¤ ê²€ìƒ‰ ê°€ëŠ¥  

```
$ kubectl get pod -l app=photo-view,env=test
NAME          READY   STATUS    RESTARTS   AGE
nginx-pod-a   1/1     Running   0          7m13s
```

|ì—°ì‚°ì|ì„¤ëª…|  
|---|---|  
`key=value` | `key` ê°’ì´ `value` ì¼ ê²½ìš°  
`key!=value` | `key` ê°’ì´ `value` ì•„ë‹ ê²½ìš°  
`'key in (...value)'` | `key` ê°’ì´ `value` ì— í¬í•¨ ë ê²½ìš°  
`'key notin (...value)'` | `key` ê°’ì´ `value` ì— í¬í•¨ë˜ì§€ ì•Šì„ ê²½ìš°  
`key` | `key` ê°’ì´ ì¡´ì¬í•  ê²½ìš°  
`!key` | `key` ê°’ì´ ì¡´ì¬í•˜ì§€ ì•Šì„ ê²½ìš°  

> `in`, `notin` ì—°ì‚°ì€ í™€ë”°ì˜´í‘œë¡œ ë¬¶ì–´ì£¼ì–´ì•¼ í•œë‹¤.  
ì½¤ë§ˆë¡œ `AND` ì—°ì‚°ì€ ì‚¬ìš© ê°€ëŠ¥í•˜ì§€ë§Œ `OR` ì—°ì‚°ì€ ì‚¬ìš© ë¶ˆê°€ëŠ¥í•˜ë‹¤.  

ì‚­ì œëª…ë ¹  
```
$ kubectl delete -f Label/label-pod.yaml
pod "nginx-pod-a" deleted
pod "nginx-pod-b" deleted
```

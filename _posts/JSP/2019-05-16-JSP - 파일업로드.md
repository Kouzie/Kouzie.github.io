---
title:  "JSP/Servlet - íŒŒì¼ ì—…ë¡œë“œ !"

read_time: false
share: false
author_profile: false
# classes: wide

categories:
  - JSP

tags:
  - JSP
  - servelt

toc: true
toc_sticky: true

---

## íŒŒì¼ ì—…ë¡œë“œ

ë¬´ì¡°ê±´ postë°©ì‹

ë‘ê°€ì§€ ì¸ì½”ë”© ë°©ì‹ì— ë”°ë¼ ì „ì†¡í•˜ëŠ” ë°ì´í„° í˜•ì‹ì´ ë‹¬ë¼ì§„ë‹¤.

íŒŒì¼ ì „ì†¡ì‹œì—ëŠ” `multipart/form-data`  ë°©ì‹ì„ ì‚¬ìš©í•˜ì
```html
<form method="post" enctype="multipart/form-data">
...
</form>
```

ê¸°ì¡´ì—ëŠ” íŒŒì¼ ì—…ë¡œë“œìš© APIê°€ ë³„ë„ë¡œ í•„ìš”í–ˆì§€ë§Œ ì„œë¸”ë¦¿ 3.0ë¶€í„°ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ ì—†ì´ ì‚¬ìš© ê°€ëŠ¥í•˜ë‹¤.  

## ë¼ì´ë¸ŒëŸ¬ë¦¬ ì—†ì´ í•˜ëŠ” ë°©ë²•

```html
<form action="ex01_01.jsp" method="post" enctype="multipart/form-data">
	ì´ë¦„: <input type="text" name="name" value="í™ê¸¸ë™"/>
	íŒŒì¼: <input type="file" name="upload"/>
	<input type="submit" />
</form>
```


```java
<body>
<% 
String name = request.getParameter("name");
String upload = request.getParameter("upload");
%>
ì „ì†¡ëœ ì´ë¦„: <%= name %> <br>
ì „ì†¡ëœ íŒŒì¼: <%= upload %> <br>
<hr>
${ param.name }
${ param.upload }
</body>
```
ì¶œë ¥ê°’
```
ì „ì†¡ëœ ì´ë¦„: null 
ì „ì†¡ëœ íŒŒì¼: null 
```

ìœ„íŒŒì¼ì—ì„œ ì „ë‹¬ë°›ì•„ë„ `null`ë¡œ ì¶œë ¥ë§Œëœë‹¤.

`requset.getParameter()`ë¡œëŠ” `multipart/form-data`í˜•ì‹ìœ¼ë¡œ ë³´ë‚¸ ê°’ì€ ë°›ì„ìˆ˜ ì—†ë‹¤.  

`multipart/form-data`ë°©ì‹ìœ¼ë¡œ ì „ì†¡í•  ë•Œ ë¬¸ìì—´, ì‚¬ì§„ ìƒê´€ ì—†ì´ ìŠ¤íŠ¸ë¦¼ ë°©ì‹ìœ¼ë¡œ ì „ì†¡ëœë‹¤.  
`request.getInputStream()` ë©”ì„œë“œê°€ ë°˜í™˜í•œ `ServletInputStream`ê°ì²´ë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ì „ë‹¬ë°›ì„ ìˆ˜ ìˆë‹¤.

```java
<%@page import="java.io.DataInputStream"%>
<%@page import="java.util.Enumeration"%>
<%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%
   request.setCharacterEncoding("UTF-8");  
   // String contentType = request.getContentType();
   Enumeration<String> en = request.getHeaderNames();
   out.println("> ì „ì†¡ë°›ì€ í—¤ë” ì •ë³´ ì¶œë ¥<br>");
   while( en.hasMoreElements() ){
	   String key = en.nextElement();
	   String value = request.getHeader(key);
	   out.println(key+" : "+ value + "<br>");
   }
   
   out.println("<br> > ì „ì†¡ë°›ì€ ë°ì´í„° ì¶œë ¥<br>");
   ServletInputStream sis= request.getInputStream();
   DataInputStream dis = new DataInputStream(sis);
   String line = "";
   while( ( line = dis.readLine() ) != null ){
	   out.println( new String( 
			   line.getBytes("ISO-8859-1"), "UTF-8" ) +"<br>" );
   }
%>
```

ì¶œë ¥ê°’
```
> ì „ì†¡ë°›ì€ í—¤ë” ì •ë³´ ì¶œë ¥
host : localhost
connection : keep-alive
content-length : 9861
cache-control : max-age=0
origin : http://localhost
upgrade-insecure-requests : 1
content-type : multipart/form-data; boundary=----WebKitFormBoundarykY7CNu84ndk1cpC0
user-agent : Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36
accept : text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3
referer : http://localhost/jspPro/days23/ex01.jsp
accept-encoding : gzip, deflate, br
accept-language : ko-KR,ko;q=0.9,en-US;q=0.8,en;q=0.7
cookie : JSESSIONID=1B0815C52ADC044D13BD5D88BF9A1EE2

> ì „ì†¡ë°›ì€ ë°ì´í„° ì¶œë ¥
------WebKitFormBoundarykY7CNu84ndk1cpC0
Content-Disposition: form-data; name="name"

í™ê¸¸ë™
------WebKitFormBoundarykY7CNu84ndk1cpC0
Content-Disposition: form-data; name="upload"; filename="bandmember.jpg"
Content-Type: image/jpeg

ï¿½ï¿½ï¿½ï¿½JFIFï¿½ï¿½C
%# , #&')*)-0-(0%()(ï¿½ï¿½C
...
...
binary ê°’....
```

ìŠ¤íŠ¸ë¦¼ í˜•ì‹ì´ë‹¤ë³´ë‹ˆ ë¬¸ìì—´ë¡œ ì „ë‹¬ë°›ìœ¼ë©° `getParameter` ë“±ê³¼ ê°™ì€ ë©”ì„œë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤...


## ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©í•˜ê¸°

ì „ì†¡ë°›ì€ ë°ì´í„°ë¥¼ í¸í•˜ê²Œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•´ì•¼ í•˜ëŠ”ë° ì•„ë˜ ì‚¬ì´íŠ¸ì—ì„œ ì œê³µí•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì.

> http://www.servlets.com/cos/

`cos-20.08.zip`íŒŒì¼ì„ ë‹¤ìš´ë°›ê³  `cos.jar`íŒŒì¼ì„ libí´ë”ì— ì¶”ê°€í•œë‹¤.  

`cos.jar`íŒŒì¼ì—ì„  `MultipartRequest`ê°ì²´ë¥¼ ì œê³µí•˜ë©° `multipart/form-data`ë°©ì‹ìœ¼ë¡œ ì „ë‹¬ë°›ì€ ë°ì´í„°ë¥¼ ì‰½ê²Œ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤.  

`MultipartRequest` ìƒì„±ê³¼ì •ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.  

```java
MultipartRequest mrequest = new MultipartRequest(
  request       //MultipartRequestë¥¼ ë§Œë“¤ê¸° ìœ„í•œ request
, saveDirectory //ì €ì¥ ìœ„ì¹˜ (Fileê°ì²´)
, maxPostSize   //ìµœëŒ€í¬ê¸° (int)
, encoding      //ì¸ì½”ë”© íƒ€ì… ("utf-8")
, policy        //íŒŒì¼ ì •ì±… (FileRenamePolicyê°ì²´)
); 
```
ë§¤ê°œë³€ìˆ˜ë¡œ 5ê°œê°€ ë“¤ì–´ê°€ëŠ”ë° ì£¼ì„ê³¼ ê°™ì€ ë‚´ìš©ë“¤ì´ ë“¤ì–´ê°„ë‹¤.  

`policy`ê°€ íŠ¹ì´í•œë° íŒŒì¼ì„ `saveDirectory`ì— ì—…ë¡œë“œí•  ë•Œ ì´ë¯¸ ì¤‘ë³µëœ ì´ë¦„ì´ ìˆë‹¤ë©´ ì–´ë–»ê²Œ ì²˜ë¦¬í• ì§€ ê²°ì •í•˜ëŠ” ë§¤ê°œë³€ìˆ˜ì´ë‹¤.

ì „ì²´ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.
```java
<%@page import="com.oreilly.servlet.multipart.DefaultFileRenamePolicy"%>
<%@page import="java.io.File"%>
<%@page import="com.oreilly.servlet.multipart.FileRenamePolicy"%>
<%@page import="com.oreilly.servlet.MultipartRequest"%>

<%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%
	// 1. upload í´ë” ìƒì„±ì´ ì•ˆë˜ì–´ ìˆìœ¼ë©´ ìƒì„±
	String saveDirectory = pageContext.getServletContext().getRealPath("/days23/upload");
	System.out.println(saveDirectory);

	File saveDir = new File(saveDirectory);
	if (!saveDir.exists())
		saveDir.mkdirs();

	// 2. ìµœëŒ€í¬ê¸° ì„¤ì •
	int maxPostSize = 1024 * 1024 * 5; // 5MB  ë‹¨ìœ„ byte

	//3. ì¸ì½”ë”© ë°©ì‹ ì„¤ì •
	String encoding = "UTF-8";

	//4. íŒŒì¼ì •ì±…, íŒŒì¼ì´ë¦„ ì¶©ë™ì‹œ ë®ì–´ì”Œì–´ì§ìœ¼ë¡œ íŒŒì¼ì´ë¦„ ë’¤ì— ì¸ë±ìŠ¤ë¥¼ ë¶™ì¸ë‹¤.
  //a.txt
	//a1.txt ì™€ ê°™ì€ í˜•ì‹ìœ¼ë¡œ ì €ì¥ëœë‹¤.
	FileRenamePolicy policy = new DefaultFileRenamePolicy();
	MultipartRequest mrequest 
	= new MultipartRequest(request //MultipartRequestë¥¼ ë§Œë“¤ê¸° ìœ„í•œ request
			, saveDirectory //ì €ì¥ ìœ„ì¹˜
			, maxPostSize //ìµœëŒ€í¬ê¸°
			, encoding //ì¸ì½”ë”© íƒ€ì…
			, policy); //íŒŒì¼ ì •ì±…
	
	String name = mrequest.getParameter("name");
	File uploadFile = mrequest.getFile("upload");
  //input type="file" íƒœê·¸ì˜ nameì†ì„±ê°’ì„ ì´ìš©í•´ íŒŒì¼ê°ì²´ë¥¼ ìƒì„±
	long uploadFile_length = uploadFile.length();
	String originalFileName = mrequest.getOriginalFileName("upload"); //ê¸°ì¡´ ì´ë¦„
	String filesystemName = mrequest.getFilesystemName("upload"); //ê¸°ì¡´
%>

> ì´ë¦„ :
<%=name%><br>
> ì²¨ë¶€ëœ íŒŒì¼ëª… :
<%=uploadFile.getName()%><br>
>>> originalFileName :
<%=originalFileName%>
<br>
>>> filesystemName :
<%=filesystemName%>
<br>
> ì²¨ë¶€ëœ íŒŒì¼ í¬ê¸° :
<%=uploadFile_length%>
bytes
<br>
```
ê¼­ `type="file"` ì´ ì•„ë‹ˆë”ë¼ë„ `getParameter()`ë©”ì„œë“œë¡œ íŒŒë¼ë¯¸í„°ê°’ì„ ì–»ì–´ì˜¬ ìˆ˜ ìˆë‹¤.  

ì¶œë ¥ê°’  
```
> ì´ë¦„ : í™ê¸¸ë™
> ì²¨ë¶€ëœ íŒŒì¼ëª… : data1.txt
>>> originalFileName : data.txt 
>>> filesystemName : data1.txt 
> ì²¨ë¶€ëœ íŒŒì¼ í¬ê¸° : 9223 bytes 
```

ì´í´ë¦½ìŠ¤ì—ì„œ ì‚¬ìš©í•  ê²½ìš° ì‹¤ì œ ì €ì¥ ìœ„ì¹˜ê°€ `contextpath`ì•„ë˜ì— ì €ì¥ë˜ëŠ” ê²ƒ ì´ ì•„ë‹Œ   
ì´í´ë¦½ìŠ¤ í”„ë¡œì íŠ¸ ì „ìš©ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” íŒŒì¼ ì €ì¥ ê²½ë¡œì— ì €ì¥ëœë‹¤.  
ì‹¤ì œìœ„ì¹˜ `C:\Class\JSPClass\.metadata\.plugins\org.eclipse.wst.server.core\tmp0\wtpwebapps\jspPro\days23\upload`

```
data.txt
data1.txt
```

> `contextPath` ê¹Œì§€ì˜ ì‹¤ì œ íŒŒì¼ ì‹œìŠ¤í…œ ê²½ë¡œë¥¼ ì–»ê³  ì‹¶ë‹¤ë©´ `request.getContextPath()` í•¨ìˆ˜ ì‚¬ìš©.  

`new MultipartRequest()` ìƒì…©ìê°€ ì˜ˆì™¸ë°œìƒì—†ì´ ëë‚˜ë©´ íŒŒì¼ì€ ì‹¤ì œ ì‹œìŠ¤í…œì— ì €ì¥ë˜ì–´ ìˆëŠ” ìƒíƒœì´ê³  ì—¬ëŸ¬ê°œì˜ `input type="file"` íƒœê·¸ë¥¼ í†µí•´ íŒŒì¼ì„ ë™ì‹œì— ì—¬ëŸ¬ê°œ ì €ì¥ë„ ê°€ëŠ¥í•˜ë‹¤.  

> ë‹¨ ê°ê°ì˜ íŒŒì¼ì„ ë³„ë„ì˜ ë””ë ‰í† ë¦¬ì— ì €ì¥í•˜ëŠ” ê²ƒì€ ë¶ˆê°€ëŠ¥... saveDirectoryì— ì„¤ì •í•œ ëŒ€ë¡œë§Œ ì €ì¥ ê°€ëŠ¥í•˜ë‹¤.  



